import{_ as ee,D as te,e as ae,y as le,z as oe,f as s,t as se,r as p,o as i,c as d,g as z,h as r,i as c,j as k,A as P,F as ne,B as j,k as ie,a as W,d as R,b as A,m as ce,s as J,C as re,n as de,E as ue,G as _e,p as me}from"./index.min.js";import{e as ve}from"./editable_map_location-uq_QjuLd.min.js";import he from"./routeWizard-QZqOxARQ.min.js";import"./index.es-sRIzCSW1.min.js";const ge=R(()=>A(()=>import("./map-GtxasIM0.min.js"),__vite__mapDeps([0,1,2,3]))),fe=R(()=>A(()=>import("./side-form-create-JBg2Ne6i.min.js"),__vite__mapDeps([4,2,3,5,6]))),pe=R(()=>A(()=>import("./side-form-update-R9r6rd9J.min.js"),__vite__mapDeps([7,2,3,5,6,8,9,1]))),be=R(()=>A(()=>import("./form_field-Zz1KsiLe.min.js"),__vite__mapDeps([8,2,3,5,6,9,1]))),we={components:{datatabble:te,SideFormCreate:fe,SideFormUpdate:pe,maps:ge,delete_icon:ae,car_icon:le,route_icon:oe,form_field:be,editable_map_location:ve,route_wizard:he},name:"Routes",setup(h){const _=h.conf.url+h.path+"?load=json",g=s(!1),t=s(!1),D=s(null),a=s({}),E=s("Info"),u=s({}),y=s({});s([]),s(!0);const b=s(""),F=s(null),I=s(!1),x=s(!1),l=s(["Info","Time","Start location","End location","Driver"]),m=s([]),w=s(!1),L=s(""),G=()=>{g.value=!1,t.value=!1};(()=>{ce(_).then(e=>{u.value=JSON.parse(JSON.stringify(e)),T()})})();const O=async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{a.value.start_latitude=e.coords.latitude,a.value.start_longitude=e.coords.longitude,a.value.end_latitude=e.coords.latitude,a.value.end_longitude=e.coords.longitude},e=>{a.value.start_latitude=30.06,a.value.start_longitude=31.21,a.value.end_latitude=30.06,a.value.end_longitude=31.21,J(e.message)}):(J("location error"),F.value="Geolocation is not supported by this browser.")},U=()=>{a.value={},x.value=!0,O()},q=async()=>{let e=L.value.length>3?await re(h.system_setting.google_map_api,L.value,h.business_setting.country):"";m.value=e.predictions},K=()=>{var e=new URLSearchParams;let o=JSON.parse(JSON.stringify(a.value)),n=Object.keys(o),f;for(let v=0;v<n.length;v++)f=n[v],e.append("params["+f+"]",o[f]);e.append("type","Route.create"),de(e,"/api/create").then(v=>{ue(v)})},T=()=>{for(let e=0;e<u.value.items.length;e++)u.value.items[e].active=b.value.trim()?M(u.value.items[e]):1},M=e=>{let o=!!e.route_name.toLowerCase().includes(b.value.toLowerCase());return o||!!e.description.toLowerCase().includes(b.toLowerCase())},H=(e,o)=>{a.value=e;for(let n=0;n<u.value.items.length;n++)u.value.items[n].selected=!1;u.value.items[o].selected=!0,N.value=V(e)},Q=async e=>{a.value.start_latitude=e.lat(),a.value.start_longitude=e.lng(),a.value.start_address=await _e(e.lat(),e.lng())},X=e=>{a.value.end_latitude=e.lat(),a.value.end_longitude=e.lng()},Y=(e,o,n)=>{},V=e=>{let o,n=[],f=h.conf.url+"uploads/images/blue_pin.gif",v=h.conf.url+"uploads/images/car.svg",C=h.conf.url+"uploads/images/destination.svg";for(let S=0;S<e.pickup_locations.length;S++)o=e.pickup_locations[S],n[S]={title:o.student_name,icon:f,origin:{lat:parseFloat(o.latitude),lng:parseFloat(o.longitude)},destination:{lat:parseFloat(o.latitude),lng:parseFloat(o.longitude)}};let B={icon:v,origin:{lat:parseFloat(e.vehicle.last_latitude),lng:parseFloat(e.vehicle.last_longitude)},destination:{lat:parseFloat(e.vehicle.last_latitude),lng:parseFloat(e.vehicle.last_longitude)}};n[n.length]=B;let $={drag:!0,icon:C,origin:B.origin,destination:{lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)}};return n[n.length]=$,y.value=n[0].destination,n},Z=(e,o)=>{switch(e){case"view":break;case"edit":a.value=o,x.value=!0;break;case"delete":me("route_id",o,"Route.delete");break;case"close":t.value=!1,g.value=!1,D.value=!1,a.value={};break}},N=s([]);return{setPlaceMarker:async e=>{a.value.start_address=e.description;const o=new google.maps.places.PlacesService(document.createElement("div"));let n=e.place_id;o.getDetails({placeId:n},(f,v)=>{if(v===google.maps.places.PlacesServiceStatus.OK&&f){const C=f.geometry.location;a.value.start_longitude=C.lng(),a.value.start_latitude=C.lat(),m.value=[],w.value=!1}else console.error("Failed to fetch place details")})},showPlaceSearch:w,startPlaceChanged:q,start_placeSearch:L,places:m,showAddSide:g,waypoints:N,showEditSide:t,url:_,content:u,fillable:l,center:y,activeItem:a,activeTab:E,translate:se,setLocationsPickups:V,clickMarker:Y,updateStartMarker:Q,updateEndMarker:X,setLocationsMarkers:H,checkSimilar:M,searchTextChanged:T,searchText:b,getUserLocation:O,showWizard:x,collapsed:I,closeSide:G,saveRoute:K,addRouteWizard:U,handleAction:Z}},props:["path","lang","system_setting","business_setting","setting","conf","auth"]},ke={class:"w-full flex overflow-auto"},xe={key:0,class:"w-full relative"},ye={key:1,class:""},Ce={class:"card"},Se={class:"card-body"},ze={class:"card-px text-center pt-15 pb-15"},Pe=["textContent"],Re=["textContent"],Ae=["textContent"],Ee={class:"text-center pb-15 px-5"},Fe=["src"],Ie={key:2,class:"flex-1 overflow-x-hidden overflow-y-auto w-full relative"},Le={class:"px-4 mb-6 py-4 rounded-lg shadow-md bg-white dark:bg-gray-700 flex w-full"},We=["textContent"],De=c("hr",{class:"mt-2"},null,-1),Oe={class:"w-full"},Te=["src"],Me={class:"w-full h-8 relative flex"},Ve=["src"],Ne=["textContent"],Be=["onClick"],je=["onClick"];function Je(h,_,g,t,D,a){const E=p("route_wizard"),u=p("route_icon"),y=p("vue-feather"),b=p("delete_icon"),F=p("datatabble"),I=p("side-form-create"),x=p("side-form-update");return i(),d("div",ke,[t.content?(i(),d("div",xe,[t.showWizard?(i(),z(E,{onCallback:_[0]||(_[0]=l=>t.showWizard=!1),key:t.showWizard,drivers:t.content.drivers,vehicles:t.content.vehicles,system_setting:g.system_setting,item:t.activeItem,business_setting:g.business_setting},null,8,["drivers","vehicles","system_setting","item","business_setting"])):r("",!0),!t.showWizard&&t.content.items&&!t.content.items.length?(i(),d("div",ye,[c("div",Ce,[c("div",Se,[c("div",ze,[c("h2",{class:"fs-2x fw-bold mb-0",textContent:k(t.content.title)},null,8,Pe),c("p",{class:"text-gray-400 fs-4 font-semibold py-7",textContent:k(t.translate("Add your first route using this below wizard"))},null,8,Re),c("a",{textContent:k(t.translate("add_new")),onClick:_[1]||(_[1]=(...l)=>t.addRouteWizard&&t.addRouteWizard(...l)),href:"javascript:;",class:"text-white btn btn-primary er fs-6 px-8 py-4"},null,8,Ae)]),c("div",Ee,[c("img",{src:"/src/asset/img/1.png",alt:"",class:"mx-auto mw-100 h-200px h-sm-325px"},null,8,Fe)])])])])):r("",!0),t.content.items&&!t.showWizard?(i(),d("main",Ie,[c("div",Le,[c("h1",{class:"font-bold text-lg w-full",textContent:k(t.content.title)},null,8,We),t.showWizard?r("",!0):(i(),d("a",{key:0,href:"javascript:;",class:"uppercase p-2 mx-2 text-center text-white w-32 rounded-lg bg-danger",onClick:_[2]||(_[2]=(...l)=>t.addRouteWizard&&t.addRouteWizard(...l))},k(t.translate("add_new")),1))]),De,c("div",Oe,[t.content.columns?(i(),z(F,{key:0,class:"align-middle fs-6 gy-5 table table-row-dashed px-6","body-text-direction":t.translate("lang")=="ar"?"right":"left","fixed-checkbox":"",headers:t.content.columns,items:t.content.items},{"item-picture":P(l=>[c("img",{src:l.picture,class:"w-8 h-8 rounded-full"},null,8,Te)]),"item-pickup_locations":P(l=>[c("div",Me,[(i(!0),d(ne,null,ie(l.pickup_locations,(m,w)=>(i(),d("div",{style:j("left: "+20*w+"px"),class:"rounded-full w-8 h-8 left-0 top-0 absolute"},[w<3?(i(),d("img",{key:w,class:"rounded-full w-8 h-8 rounded-[50px] border-2 border-purple-800",src:m.student&&m.student.picture?m.student.picture:"https://via.placeholder.com/37x37"},null,8,Ve)):r("",!0)],4))),256)),c("span",{class:"flex absolute pt-2",style:j("left: "+(20*(l.pickup_locations.length<3?l.pickup_locations.length:3)+20)+"px")},[W(u),l.pickup_locations?(i(),d("span",{key:0,class:"font-semibold px-1",textContent:k(l.pickup_locations.length)},null,8,Ne)):r("",!0)],4)])]),"item-edit":P(l=>[l.not_editable?r("",!0):(i(),d("button",{key:0,class:"p-2 hover:text-gray-600 text-purple",onClick:m=>t.handleAction("edit",l)},[W(y,{class:"w-5",type:"edit"})],8,Be))]),"item-delete":P(l=>[l.not_removeable?r("",!0):(i(),d("button",{key:0,class:"p-2 hover:text-gray-600 text-red-500",onClick:m=>t.handleAction("delete",l)},[W(b,{class:"w-5"})],8,je))]),_:1},8,["body-text-direction","headers","items"])):r("",!0),t.showAddSide&&t.content&&t.content.fillable?(i(),z(I,{key:1,onCallback:t.closeSide,conf:g.conf,model:"Routes.create",columns:t.content.fillable,class:"col-md-3"},null,8,["onCallback","conf","columns"])):r("",!0),t.showEditSide&&!t.showAddSide?(i(),z(x,{onCallback:t.closeSide,key:t.activeItem,conf:g.conf,model:"Routes.update",item:t.activeItem,model_id:t.activeItem.route_id,index:"route_id",columns:t.content.fillable,class:"col-md-3"},null,8,["onCallback","conf","item","model_id","columns"])):r("",!0)])])):r("",!0)])):r("",!0)])}const Xe=ee(we,[["render",Je]]);export{Xe as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["map-GtxasIM0.min.js","index.es-sRIzCSW1.min.js","index.min.js","index.min.css","side-form-create-JBg2Ne6i.min.js","Field-s5Skb7qB.min.js","Field.min.css","side-form-update-R9r6rd9J.min.js","form_field-Zz1KsiLe.min.js","editable_map_location-uq_QjuLd.min.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
