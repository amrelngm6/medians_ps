import{_ as b,H as z,L as G,O as I,j as t,I as L,r as f,c as N,o as m,x as O,a as S,b as v,z as V,f as j,F as E,e as F}from"./index.min.js";const J={components:{GoogleMap:I,Polyline:G,CustomMarker:z},emits:["markerclicked"],setup(_,{emit:a}){const r=t(null),o=t(null),w=t(10),i=t([]),c=t([]),u=t([]),k=t({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),e=t(_.trip),y=()=>{if(e.value.status=="started")return{lat:Number(e.value.vehicle.latitude??0),lng:Number(e.value.vehicle.longitude??0)}},C=(l,s,p)=>{let n=JSON.parse(JSON.stringify(l));return n.icon=_.conf.url+"uploads/images/"+p,n.marker_position=s,n.drag=!1,n};(()=>{i.value=[C(e.value,y()??{lat:e.value.pickup_latitude,lng:e.value.pickup_longitude},"car.svg")],i.value[i.value.length]=C(e.value,{lat:e.value.destination_latitude,lng:e.value.destination_longitude},"destination.svg")})();const h=t({lat:0,lng:0}),x=t({lat:0,lng:0}),P=t(null),d=t(null),B=()=>{setTimeout(function(){P.value=new window.google.maps.DirectionsService,d.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:r,panel:document.getElementById("panel")}),d.value.addListener("directions_changed",()=>{d.value.getDirections()}),D(h.value,x.value,P.value,d.value)},1e3)},D=(l,s,p,n)=>{p.route({origin:l,destination:s,travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(g=>{console.log(g);const M=R(g);u.value=M,c.value={path:M,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(g=>{alert("Could not display directions due to: "+g)})},R=l=>{const s=l.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(s).map(n=>({lat:n.lat(),lng:n.lng()}))},T=l=>{a("markerclicked",l)};return L(()=>{h.value=y()??{lat:e.value.pickup_latitude,lng:e.value.pickup_longitude},o.value=h.value,x.value={lat:e.value.destination_latitude,lng:e.value.destination_longitude},B()}),{map:r,markerClicked:T,markers:i,mapCenter:o,mapZoom:w,polylinePath:c,routeCoordinates:u,polylineOptions:k}},props:["system_setting","trip","conf"]},W={class:"w-full overflow-auto"},Z={style:{"text-align":"center"}},H=["src"];function q(_,a,r,o,w,i){const c=f("Polyline"),u=f("CustomMarker"),k=f("GoogleMap");return m(),N("div",W,[o.mapCenter?(m(),O(k,{"api-key":r.system_setting.google_map_api,ref:"map",center:o.mapCenter,key:`${o.mapCenter.lat},${o.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:o.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:V(()=>[j(c,{options:o.polylinePath},null,8,["options"]),(m(!0),N(E,null,F(o.markers,(e,y)=>(m(),O(u,{options:{position:e.marker_position},onClick:C=>o.markerClicked(e)},{default:V(()=>[v("div",Z,[v("img",{src:e.icon,width:"40",class:"rounded-full",height:"40",style:{"margin-top":"8px"}},null,8,H)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):S("",!0),a[0]||(a[0]=v("div",{id:"panel"},null,-1)),a[1]||(a[1]=v("div",{id:"total"},null,-1))])}const Q=b(J,[["render",q]]);export{Q as t};
