import{_ as R,r as t,U as F,a as h,o as m,c as x,y as D,O as P,g as G,F as I,f as S,d as g,b as z,ai as E}from"./index.min.js";import{O as J,L as W,j as Z}from"./index.es-BqyRJkQ3.min.js";const A={components:{GoogleMap:J,Polyline:W,CustomMarker:Z},emits:["markerclicked"],setup(_,{emit:C}){const c=t(null),o=t(null),f=t(12),r=t([]),u=t([]),d=t([]),v=t({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),n=t(_.trip),k=(e,l="lat",s="lng",i)=>{let a=JSON.parse(JSON.stringify(e));return a.icon=_.conf.url+"uploads/images/"+i,a.marker_position={lat:parseFloat(e[l]),lng:parseFloat(e[s])},a.drag=!1,a};(()=>{r.value=[k(n.value,"pickup_latitude","pickup_longitude","car.svg")],r.value[r.value.length]=k(n.value,"destination_latitude","destination_longitude","destination.svg")})();const y=t({lat:0,lng:0}),w=t({lat:0,lng:0}),M=t(null),p=t(null),B=()=>{setTimeout(function(){M.value=new window.google.maps.DirectionsService,p.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:c,panel:document.getElementById("panel")}),p.value.addListener("directions_changed",()=>{const e=p.value.getDirections();e&&T(e)}),N(y.value,w.value,M.value,p.value)},1e3)},N=(e,l,s,i)=>{s.route({origin:e,destination:l,waypoints:[{location:e}],travelMode:google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(a=>{console.log(a);const O=E(a.routes[0].overview_polyline.points);d.value=O,u.value={path:O,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(a=>{alert("Could not display directions due to: "+a)})},T=e=>{let l=0;const s=e.routes[0];if(!(!s||!s.legs)){for(let i=0;i<s.legs.length;i++)l+=s.legs[i].distance.value;l=l/1e3,document.getElementById("total").innerHTML=l+" km"}},L=async()=>B();return F(()=>{y.value={lat:n.value.pickup_latitude,lng:n.value.pickup_longitude},o.value=y.value,w.value={lat:n.value.destination_latitude,lng:n.value.destination_longitude},L()}),{map:c,markerClicked:e=>{C("markerclicked",e)},markers:r,mapCenter:o,mapZoom:f,polylinePath:u,routeCoordinates:d,polylineOptions:v}},props:["system_setting","trip","conf"]},H={class:"w-full overflow-auto"},U={style:{"text-align":"center"}},b=["src"],j=g("div",{id:"panel"},null,-1),q=g("div",{id:"total"},null,-1);function K(_,C,c,o,f,r){const u=h("Polyline"),d=h("CustomMarker"),v=h("GoogleMap");return m(),x("div",H,[o.mapCenter?(m(),D(v,{"api-key":c.system_setting.google_map_api,ref:"map",center:o.mapCenter,key:`${o.mapCenter.lat},${o.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:o.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:P(()=>[G(u,{options:o.polylinePath},null,8,["options"]),(m(!0),x(I,null,S(o.markers,(n,k)=>(m(),D(d,{options:{position:n.marker_position},onClick:V=>o.markerClicked(n)},{default:P(()=>[g("div",U,[g("img",{src:n.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,b)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):z("",!0),j,q])}const $=R(A,[["render",K]]);export{$ as t};
