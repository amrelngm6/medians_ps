import{_ as ee,D as te,e as ae,y as le,z as se,f as o,t as oe,r as p,o as i,c as d,g as P,h as r,i as c,j as w,A,F as ne,B as j,k as ie,a as D,d as E,b as R,m as ce,s as J,C as re,n as de,E as ue,G as _e,p as ve}from"./index.min.js";import{e as me}from"./editable_map_location-uq_QjuLd.min.js";import"./index.es-sRIzCSW1.min.js";const he=E(()=>R(()=>import("./map-GtxasIM0.min.js"),__vite__mapDeps([0,1,2,3]))),ge=E(()=>R(()=>import("./side-form-create-CbF3czHg.min.js"),__vite__mapDeps([4,2,3,5,6]))),fe=E(()=>R(()=>import("./side-form-update-_mffNT-n.min.js"),__vite__mapDeps([7,2,3,5,6,8,9,1]))),pe=E(()=>R(()=>import("./form_field-J_TGEATC.min.js"),__vite__mapDeps([8,2,3,5,6,9,1]))),be={components:{datatabble:te,SideFormCreate:ge,SideFormUpdate:fe,maps:he,delete_icon:ae,car_icon:le,route_icon:se,form_field:pe,editable_map_location:me},name:"Routes",setup(m){const f=m.conf.url+m.path+"?load=json",h=o(!1),t=o(!1),O=o(null),a=o({}),F=o("Info"),u=o({}),y=o({});o([]),o(!0);const b=o(""),I=o(null),z=o(!1),x=o(!1),s=o(["Info","Time","Start location","End location","Driver"]),_=o([]),k=o(!1),L=o(""),G=()=>{h.value=!1,t.value=!1};(()=>{ce(f).then(e=>{u.value=JSON.parse(JSON.stringify(e)),T()})})();const W=async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{a.value.start_latitude=e.coords.latitude,a.value.start_longitude=e.coords.longitude,a.value.end_latitude=e.coords.latitude,a.value.end_longitude=e.coords.longitude},e=>{a.value.start_latitude=30.06,a.value.start_longitude=31.21,a.value.end_latitude=30.06,a.value.end_longitude=31.21,J(e.message)}):(J("location error"),I.value="Geolocation is not supported by this browser.")},U=()=>{a.value={},x.value=!0,W()},q=async()=>{let e=L.value.length>3?await re(m.system_setting.google_map_api,L.value,m.business_setting.country):"";_.value=e.predictions},K=()=>{var e=new URLSearchParams;let l=JSON.parse(JSON.stringify(a.value)),n=Object.keys(l),g;for(let v=0;v<n.length;v++)g=n[v],e.append("params["+g+"]",l[g]);e.append("type","Route.create"),de(e,"/api/create").then(v=>{ue(v)})},T=()=>{for(let e=0;e<u.value.items.length;e++)u.value.items[e].active=b.value.trim()?M(u.value.items[e]):1},M=e=>{let l=!!e.route_name.toLowerCase().includes(b.value.toLowerCase());return l||!!e.description.toLowerCase().includes(b.toLowerCase())},H=(e,l)=>{a.value=e;for(let n=0;n<u.value.items.length;n++)u.value.items[n].selected=!1;u.value.items[l].selected=!0,N.value=V(e)},Q=async e=>{a.value.start_latitude=e.lat(),a.value.start_longitude=e.lng(),a.value.start_address=await _e(e.lat(),e.lng())},X=e=>{a.value.end_latitude=e.lat(),a.value.end_longitude=e.lng()},Y=(e,l,n)=>{},V=e=>{let l,n=[],g=m.conf.url+"uploads/images/blue_pin.gif",v=m.conf.url+"uploads/images/car.svg",C=m.conf.url+"uploads/images/destination.svg";for(let S=0;S<e.pickup_locations.length;S++)l=e.pickup_locations[S],n[S]={title:l.student_name,icon:g,origin:{lat:parseFloat(l.latitude),lng:parseFloat(l.longitude)},destination:{lat:parseFloat(l.latitude),lng:parseFloat(l.longitude)}};let B={icon:v,origin:{lat:parseFloat(e.vehicle.last_latitude),lng:parseFloat(e.vehicle.last_longitude)},destination:{lat:parseFloat(e.vehicle.last_latitude),lng:parseFloat(e.vehicle.last_longitude)}};n[n.length]=B;let $={drag:!0,icon:C,origin:B.origin,destination:{lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)}};return n[n.length]=$,y.value=n[0].destination,n},Z=(e,l)=>{switch(e){case"view":break;case"edit":a.value=l,x.value=!0;break;case"delete":ve("route_id",l,"Route.delete");break;case"close":t.value=!1,h.value=!1,O.value=!1,a.value={};break}},N=o([]);return{setPlaceMarker:async e=>{a.value.start_address=e.description;const l=new google.maps.places.PlacesService(document.createElement("div"));let n=e.place_id;l.getDetails({placeId:n},(g,v)=>{if(v===google.maps.places.PlacesServiceStatus.OK&&g){const C=g.geometry.location;a.value.start_longitude=C.lng(),a.value.start_latitude=C.lat(),_.value=[],k.value=!1}else console.error("Failed to fetch place details")})},showPlaceSearch:k,startPlaceChanged:q,start_placeSearch:L,places:_,showAddSide:h,waypoints:N,showEditSide:t,url:f,content:u,fillable:s,center:y,activeItem:a,activeTab:F,translate:oe,setLocationsPickups:V,clickMarker:Y,updateStartMarker:Q,updateEndMarker:X,setLocationsMarkers:H,checkSimilar:M,searchTextChanged:T,searchText:b,getUserLocation:W,showWizard:x,collapsed:z,closeSide:G,saveRoute:K,addRouteWizard:U,handleAction:Z}},props:["path","lang","system_setting","business_setting","setting","conf","auth"]},ke={class:"w-full flex overflow-auto"},we={key:0,class:"w-full relative"},xe={key:1,class:""},ye={class:"card"},Ce={class:"card-body"},Se={class:"card-px text-center pt-15 pb-15"},Pe=["textContent"],Ae=["textContent"],Ee=["textContent"],Re={class:"text-center pb-15 px-5"},Fe=["src"],Ie={key:2,class:"flex-1 overflow-x-hidden overflow-y-auto w-full relative"},ze={class:"px-4 mb-6 py-4 rounded-lg shadow-md bg-white dark:bg-gray-700 flex w-full"},Le=["textContent"],De=c("hr",{class:"mt-2"},null,-1),Oe={class:"w-full"},We=["src"],Te={class:"w-full h-8 relative flex"},Me=["src"],Ve=["textContent"],Ne=["onClick"],Be=["onClick"];function je(m,f,h,t,O,a){const F=p("routeWizard"),u=p("route_icon"),y=p("vue-feather"),b=p("delete_icon"),I=p("datatabble"),z=p("side-form-create"),x=p("side-form-update");return i(),d("div",ke,[t.content?(i(),d("div",we,[t.showWizard?(i(),P(F,{key:t.showWizard,drivers:t.content.drivers,vehicles:t.content.vehicles,system_setting:h.system_setting,item:t.activeItem,business_setting:h.business_setting},null,8,["drivers","vehicles","system_setting","item","business_setting"])):r("",!0),!t.showWizard&&t.content.items&&!t.content.items.length?(i(),d("div",xe,[c("div",ye,[c("div",Ce,[c("div",Se,[c("h2",{class:"fs-2x fw-bold mb-0",textContent:w(t.content.title)},null,8,Pe),c("p",{class:"text-gray-400 fs-4 font-semibold py-7",textContent:w(t.translate("Add your first route using this below wizard"))},null,8,Ae),c("a",{textContent:w(t.translate("add_new")),onClick:f[0]||(f[0]=(...s)=>t.addRouteWizard&&t.addRouteWizard(...s)),href:"javascript:;",class:"text-white btn btn-primary er fs-6 px-8 py-4"},null,8,Ee)]),c("div",Re,[c("img",{src:"/src/asset/img/1.png",alt:"",class:"mx-auto mw-100 h-200px h-sm-325px"},null,8,Fe)])])])])):r("",!0),t.content.items?(i(),d("main",Ie,[c("div",ze,[c("h1",{class:"font-bold text-lg w-full",textContent:w(t.content.title)},null,8,Le),t.showWizard?r("",!0):(i(),d("a",{key:0,href:"javascript:;",class:"uppercase p-2 mx-2 text-center text-white w-32 rounded-lg bg-danger",onClick:f[1]||(f[1]=s=>{t.showAddSide=!0,t.activeItem={}})},w(t.translate("add_new")),1))]),De,c("div",Oe,[t.content.columns?(i(),P(I,{key:0,class:"align-middle fs-6 gy-5 table table-row-dashed px-6","body-text-direction":t.translate("lang")=="ar"?"right":"left","fixed-checkbox":"",headers:t.content.columns,items:t.content.items},{"item-picture":A(s=>[c("img",{src:s.picture,class:"w-8 h-8 rounded-full"},null,8,We)]),"item-pickup_locations":A(s=>[c("div",Te,[(i(!0),d(ne,null,ie(s.pickup_locations,(_,k)=>(i(),d("div",{style:j("left: "+20*k+"px"),class:"rounded-full w-8 h-8 left-0 top-0 absolute"},[k<3?(i(),d("img",{key:k,class:"rounded-full w-8 h-8 rounded-[50px] border-2 border-purple-800",src:_.student&&_.student.picture?_.student.picture:"https://via.placeholder.com/37x37"},null,8,Me)):r("",!0)],4))),256)),c("span",{class:"flex absolute pt-2",style:j("left: "+(20*(s.pickup_locations.length<3?s.pickup_locations.length:3)+20)+"px")},[D(u),s.pickup_locations?(i(),d("span",{key:0,class:"font-semibold px-1",textContent:w(s.pickup_locations.length)},null,8,Ve)):r("",!0)],4)])]),"item-edit":A(s=>[s.not_editable?r("",!0):(i(),d("button",{key:0,class:"p-2 hover:text-gray-600 text-purple",onClick:_=>t.handleAction("edit",s)},[D(y,{class:"w-5",type:"edit"})],8,Ne))]),"item-delete":A(s=>[s.not_removeable?r("",!0):(i(),d("button",{key:0,class:"p-2 hover:text-gray-600 text-red-500",onClick:_=>t.handleAction("delete",s)},[D(b,{class:"w-5"})],8,Be))]),_:1},8,["body-text-direction","headers","items"])):r("",!0),t.showAddSide&&t.content&&t.content.fillable?(i(),P(z,{key:1,onCallback:t.closeSide,conf:h.conf,model:"Routes.create",columns:t.content.fillable,class:"col-md-3"},null,8,["onCallback","conf","columns"])):r("",!0),t.showEditSide&&!t.showAddSide?(i(),P(x,{onCallback:t.closeSide,key:t.activeItem,conf:h.conf,model:"Routes.update",item:t.activeItem,model_id:t.activeItem.route_id,index:"route_id",columns:t.content.fillable,class:"col-md-3"},null,8,["onCallback","conf","item","model_id","columns"])):r("",!0)])])):r("",!0)])):r("",!0)])}const He=ee(be,[["render",je]]);export{He as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["map-GtxasIM0.min.js","index.es-sRIzCSW1.min.js","index.min.js","index.min.css","side-form-create-CbF3czHg.min.js","Field-r_1gxBn8.min.js","Field.min.css","side-form-update-_mffNT-n.min.js","form_field-J_TGEATC.min.js","editable_map_location-uq_QjuLd.min.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
