const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["form_field-DiE37Nzp.min.js","index.min.js","index.min.css","Field-DXr5lNQ3.min.js","Field.min.css","editable_map_location-CbjDPe7S.min.js"])))=>i.map(i=>d[i]);
import{_ as tt,T as et,q as st,K as lt,A as at,M as nt,r as I,c as r,o as u,a as f,b as t,f as p,d as a,N as ot,n as it,i as ct,j as n,t as b,al as j,u as dt,s as A,a9 as rt,m as ut,P as _t,Q as E,R as M,S as vt}from"./index.min.js";import{e as mt}from"./editable_map_location-CbjDPe7S.min.js";import{d as ft}from"./drivers_locations_map-CsBEI_Gf.min.js";import{t as ht}from"./taxi_trip_map-t5u1wbQN.min.js";const gt=st(()=>dt(()=>import("./form_field-DiE37Nzp.min.js"),__vite__mapDeps([0,1,2,3,4,5]))),xt={components:{taxt_trip_map:ht,close_icon:nt,delete_icon:at,car_icon:lt,form_field:gt,editable_map_location:mt,drivers_locations_map:ft,tooltip:et},name:"Taxi trips",emits:["callback"],setup(o,{emit:i}){const _=n(!1),s=n(!1),L=n(!1);n(null);const l=n({}),w=n(o.usertype),S=n({}),k=n({});n([]),n(!0);const v=n(""),P=n(null),z=n(!1),B=n([o.usertype,"Pickup location","Destination","Driver","Time","Cost","Confirm"]),y=n([]),N=n(!1),T=n(""),D=n(""),U=n([{title:b("Scheduled"),status:"scheduled"},{title:b("Started"),status:"started"},{title:b("Completed"),status:"completed"},{title:b("Cancelled"),status:"cancelled"}]);console.log(o.item),o.item?(l.value=o.item,l.value.date=o.item.date??j()):l.value.date=j();const W=o.userslist?n(o.userslist):n([]),O=async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{l.value.trip_id||(l.value.pickup_latitude=e.coords.latitude,l.value.pickup_longitude=e.coords.longitude,l.value.destination_latitude=e.coords.latitude,l.value.destination_longitude=e.coords.longitude)},e=>{l.value.trip_id||(l.value.pickup_latitude=l.value.pickup_latitude??30.06,l.value.pickup_longitude=l.value.pickup_longitude??31.21,l.value.destination_latitude=l.value.destination_latitude??30.06,l.value.destination_longitude=l.value.destination_longitude??31.21),A(e.message)}):(A("location error"),P.value="Geolocation is not supported by this browser.")};O();const q=async()=>{let e=T.value.length>3?await M(o.system_setting.google_map_api,T.value,o.business_setting.country):"";y.value=e.predictions},R=async()=>{let e=D.value.length>3?await M(o.system_setting.google_map_api,D.value,o.business_setting.country):"";y.value=e.predictions},J=()=>{_.value=!0;var e=new URLSearchParams;let c=JSON.parse(JSON.stringify(l.value)),m=Object.keys(c),d,g;for(let x=0;x<m.length;x++)d=m[x],g=typeof c[d]=="object"?JSON.stringify(c[d]):c[d],e.append("params["+d+"]",g);let C=c.trip_id>0?"update":"create";e.append("type","TaxiTrip."+C);const h=rt();h&&(h.root.data.loader=!0),ut(e,"/api/"+C).then(x=>{_t(x),_.value=!1})},K=async e=>{l.value.pickup_latitude=e.lat(),l.value.pickup_longitude=e.lng(),l.value.pickup_address=await E(e.lat(),e.lng())},F=async e=>{l.value.destination_latitude=e.lat(),l.value.destination_longitude=e.lng(),l.value.destination_address=await E(e.lat(),e.lng())},G=async(e,c)=>{const m=new google.maps.places.PlacesService(document.createElement("div"));let d=e.place_id;m.getDetails({placeId:d},(g,C)=>{if(C===google.maps.places.PlacesServiceStatus.OK&&g){const h=g.geometry.location;c=="pickup"&&(l.value.pickup_address=e.description,l.value.pickup_latitude=h.lat(),l.value.pickup_longitude=h.lng()),c=="destination"&&(l.value.destination_address=e.description,l.value.destination_latitude=h.lat(),l.value.destination_longitude=h.lng()),y.value=[],N.value=!1}else console.error("Failed to fetch place details")})},Q=()=>{i("callback")},H=()=>vt(["model_id","driver_id","pickup_address","destination_address","status"],l),X=e=>{l.value.model_id=o.usertype=="student"?e.student_id:e.customer_id,l.value.model=e,w.value="Pickup location",v.value=null},Y=e=>{l.value.driver_id=e.driver_id,l.value.driver=e,V(e.vehicle)},V=e=>{l.value.vehicle_id=e.vehicle_id,l.value.vehicle=e,v.value=null},Z=()=>{if(o.userslist)for(let e=0;e<o.userslist.length;e++)o.userslist[e].show=v.value.trim()?$(o.userslist[e]):1},$=e=>{let c=!!e.name.toLowerCase().includes(v.value.toLowerCase()),m=c||!!e.email.toLowerCase().includes(v.value.toLowerCase());return m||!!e.mobile.toLowerCase().includes(v.value.toLowerCase())};return{loader:_,tripsStatusList:U,selectedObject:(e,c)=>{const m=l.value[c];for(let d=0;d<e.length;d++)if(e[d][c]==m)return e[d];return{}},setDriver:Y,setVehicle:V,users:W,progressWidth:H,setUser:X,findUser:Z,setPlaceMarker:G,showPlaceSearch:N,pickupPlaceChanged:q,destinationPlaceChanged:R,pickup_placeSearch:T,destination_placeSearch:D,places:y,showAddSide:s,showEditSide:L,content:S,fillable:B,center:k,activeItem:l,activeTab:w,translate:b,updatePickupMarker:K,updateDestinationMarker:F,searchText:v,getUserLocation:O,collapsed:z,saveTrip:J,back:Q}},props:["conf","path","system_setting","business_setting","setting","item","userslist","usertype","drivers","vehicles","currency"]},pt={class:"w-full"},bt={class:"w-full flex overflow-auto"},wt={class:"w-full relative"},kt={class:"card w-full py-10"},yt={class:"w-full stepper stepper-links"},Ct={class:"w-full"},It={class:""},St={class:"card-body pt-0 mx-auto"},Pt={class:"w-full flex gap-10"},Tt={class:"w-full"},Dt={class:"w-full"},Lt={class:"bg-gray-200 shadow-md mb-10 rounded-xl"},Nt={class:"card-header border-0 pt-9"},Ot={key:0,class:"card-title m-0 flex gap-4"},Vt={class:"symbol symbol-50px w-50px bg-light"},jt=["src"],At={class:"w-full"},Et=["textContent"],Mt=["textContent"],zt={key:0,class:"card-body p-9"},Bt={class:"timeline timeline-border-dashed"},Ut={class:"timeline-item"},Wt={class:"timeline-icon me-4"},qt={class:"timeline-content mb-10 mt-n2"},Rt={class:"overflow-auto pe-3"},Jt=["textContent"],Kt={class:"d-flex align-items-center mt-1 fs-6"},Ft=["textContent"],Gt={class:"timeline-item"},Qt={class:"timeline-icon me-4"},Ht={class:"timeline-content mb-10 mt-n2"},Xt={class:"overflow-auto pe-3"},Yt=["textContent"],Zt={class:"d-flex align-items-center mt-1 fs-6"},$t=["textContent"],te={class:"h-4px w-100 bg-light mb-5"},ee={key:0,class:"w-full flex gap-4"},se={key:0,class:"flex gap-4 w-full"},le=["src"],ae={class:"block gap-4 w-full"},ne=["textContent"],oe=["textContent"],ie={key:1,class:"w-full flex gap-4"},ce={class:"block gap-4"},de=["textContent"],re=["textContent"],ue={key:2,class:"w-full flex-end"},_e=["textContent"],ve={class:"w-full flex gap-4"},me=["textContent"],fe=["textContent"],he={class:"flex gap-6 pb-4 font-semibold text-lg"},ge={class:"flex gap-6 w-full"},xe=["textContent"],pe=["textContent"],be={class:"flex gap-6 w-full"},we=["textContent"],ke=["textContent"],ye={class:"flex gap-6 w-full"},Ce=["textContent"],Ie=["textContent"],Se={class:"notice d-flex bg-light-warning rounded border-warning border border-dashed mb-12 p-6 gap-4"},Pe={class:"d-flex flex-stack flex-grow-1"},Te={class:"fw-semibold"},De=["textContent"],Le={class:"fs-6 text-gray-700"},Ne=["textContent"],Oe={class:"text-center mt-10"},Ve=["textContent"];function je(o,i,_,s,L,l){const w=I("close_icon"),S=I("taxt_trip_map"),k=I("vue-feather"),v=I("car_icon");return u(),r("div",pt,[s.loader?(u(),r("div",{key:s.loader,class:"bg-white fixed w-full h-full top-0 left-0",style:{"z-index":"99999",opacity:".9"}},[...i[1]||(i[1]=[t("img",{class:"m-auto w-500px",src:"/uploads/loader.gif"},null,-1)])])):f("",!0),t("div",bt,[t("div",wt,[p(w,{class:"absolute top-4 right-4 z-10 cursor-pointer",onClick:s.back},null,8,["onClick"]),t("div",kt,[t("div",yt,[t("div",Ct,[t("div",It,[t("div",St,[t("div",Pt,[t("div",Tt,[p(S,{onMarkerclicked:o.markerClicked,class:"w-full rounded-xl shadow-md mx-4",system_setting:_.system_setting,conf:_.conf,trip:s.activeItem},null,8,["onMarkerclicked","system_setting","conf","trip"])]),t("div",Dt,[i[5]||(i[5]=t("hr",{class:"block mt-6 my-2 opacity-10"},null,-1)),t("div",Lt,[t("div",Nt,[s.activeItem.model?(u(),r("div",Ot,[t("div",Vt,[t("img",{src:s.activeItem.model.picture,alt:"image",class:"p-3"},null,8,jt)]),t("div",At,[t("div",{class:"font-semibold",textContent:a(s.activeItem.model.name)},null,8,Et),t("div",{class:"",textContent:a(s.activeItem.model.mobile)},null,8,Mt)])])):f("",!0)]),s.activeItem?(u(),r("div",zt,[t("div",Bt,[t("div",Ut,[i[2]||(i[2]=t("div",{class:"timeline-line"},null,-1)),t("div",Wt,[p(k,{type:"circle",class:"fs-2 text-success"})]),t("div",qt,[t("div",Rt,[s.activeItem?(u(),r("div",{key:0,class:"fs-5 fw-semibold mb-2",textContent:a(s.activeItem.pickup_address)},null,8,Jt)):f("",!0),t("div",Kt,[t("div",{class:"text-muted me-2 fs-7",textContent:a(s.translate("Pickup"))},null,8,Ft)])])])]),t("div",Gt,[i[3]||(i[3]=t("div",{class:"timeline-line"},null,-1)),t("div",Qt,[p(k,{type:"map-pin",class:"fs-2 text-danger"})]),t("div",Ht,[t("div",Xt,[s.activeItem?(u(),r("div",{key:0,class:"fs-5 fw-semibold mb-2",textContent:a(s.activeItem.destination_address)},null,8,Yt)):f("",!0),t("div",Zt,[t("div",{class:"text-muted me-2 fs-7",textContent:a(s.translate("Destination"))},null,8,$t)])])])])]),t("div",te,[t("div",{class:it(["rounded h-4px transition transition-all",s.progressWidth()<100?"bg-info":"bg-success"]),role:"progressbar",style:ot({width:s.progressWidth()+"%"})},null,6)]),s.activeItem?(u(),r("div",ee,[s.activeItem.driver?(u(),r("div",se,[t("img",{src:s.activeItem.driver.picture,class:"rounded-full bg-white border-1 border border-gray-600 p-1 w-12 h-12"},null,8,le),t("div",ae,[t("span",{class:"w-full block font-semibold",textContent:a(s.translate("Driver"))},null,8,ne),t("span",{class:"w-full block",textContent:a(s.activeItem.driver.name)},null,8,oe)])])):f("",!0),s.activeItem.vehicle?(u(),r("div",ie,[p(v),t("div",ce,[t("span",{class:"w-full block font-semibold",textContent:a(s.translate("Vehicle"))},null,8,de),t("span",{class:"w-full block",textContent:a(s.activeItem.vehicle.plate_number)},null,8,re)])])):f("",!0),s.activeItem.date?(u(),r("div",ue,[t("span",{class:"w-full block font-semibold",textContent:a(s.translate("Trip date"))},null,8,_e),t("div",ve,[t("span",{class:"",textContent:a(s.activeItem.date)},null,8,me),t("span",{class:"",textContent:a(s.activeItem.start_time)},null,8,fe)])])):f("",!0)])):f("",!0)])):f("",!0)]),t("div",he,[t("div",ge,[t("div",{textContent:a(s.translate("Subtotal"))},null,8,xe),t("div",{textContent:a(_.currency.symbol+""+s.activeItem.subtotal)},null,8,pe)]),t("div",be,[t("div",{textContent:a(s.translate("Discount"))},null,8,we),t("div",{textContent:a(_.currency.symbol+""+s.activeItem.discount_amount)},null,8,ke)]),t("div",ye,[t("div",{textContent:a(s.translate("Total cost"))},null,8,Ce),t("div",{textContent:a(_.currency.symbol+""+s.activeItem.total_cost)},null,8,Ie)])]),t("div",Se,[i[4]||(i[4]=ct('<i class="vue-feather vue-feather--alert-octagon ki-duotone ki-information fs-2tx text-warning me-4" data-name="alert-octagon" data-tags="warning,alert,danger" data-type="alert-octagon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-octagon vue-feather__content"><polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"></polygon><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg></i>',1)),t("div",Pe,[t("div",Te,[t("h4",{class:"text-gray-900 fw-bold",textContent:a(s.translate(s.activeItem.payment_status))},null,8,De),t("div",Le,[t("div",{textContent:a(s.translate("Payment status"))},null,8,Ne)])])])])])]),t("p",Oe,[t("a",{href:"javascript:;",class:"uppercase px-4 py-3 mx-2 text-center text-white rounded-lg bg-danger",onClick:i[0]||(i[0]=(...P)=>s.back&&s.back(...P)),textContent:a(s.translate("Back"))},null,8,Ve)])])])])])])])])])}const Ue=tt(xt,[["render",je]]);export{Ue as default};
