const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["map-CbOzg2Wr.min.js","index.min.js","index.min.css","side-form-create-B2Ekk4lj.min.js","Field-DXr5lNQ3.min.js","Field.min.css","side-form-update-Bpfkw8M2.min.js","form_field-DiE37Nzp.min.js","editable_map_location-CbjDPe7S.min.js"])))=>i.map(i=>d[i]);
import{_ as lt,H as mt,L as vt,O as ft,j as _,I as ht,r as y,c as a,o as s,x as O,a as c,z as j,f as P,F as W,e as q,b as e,q as B,J as it,K as rt,A as ct,M as gt,D as dt,t as _t,u as G,d as l,n as at,w as E,v as L,N as ot,s as tt,m as xt,P as pt,Q as nt,R as st,S as bt,T as yt,y as Ct,k as kt,l as wt}from"./index.min.js";import{e as ut}from"./editable_map_location-CbjDPe7S.min.js";import{d as It}from"./drivers_locations_map-CsBEI_Gf.min.js";const St={components:{GoogleMap:ft,Polyline:vt,CustomMarker:mt},emits:["markerclicked"],setup(f,{emit:o}){const u=_(null),t=_(null),D=_(12),r=_([]),x=_([]),k=_([]),w=_({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),v=_(f.route),b=(h,g="lat",V="lng",z)=>{let S=JSON.parse(JSON.stringify(h));return S.icon=f.conf.url+z,S.marker_position={lat:parseFloat(h[g]),lng:parseFloat(h[V])},S.drag=!1,S};(()=>{r.value=[b(v.value.position,"start_latitude","start_longitude","uploads/images/car.svg")];let h=v.value.route_locations;if(h&&h.length)for(let g=0;g<h.length;g++)console.log(h[g]),r.value[g+1]=b(h[g],"start_latitude","start_longitude",h[g].picture??"uploads/images/yellow_pin.gif");r.value[r.value.length]=b(v.value.position,"end_latitude","end_longitude","uploads/images/destination.svg")})();const p=_({lat:0,lng:0}),n=_({lat:0,lng:0}),I=_(null),M=_(null),A=()=>{setTimeout(function(){I.value=new window.google.maps.DirectionsService,M.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:u,panel:document.getElementById("panel")}),M.value.addListener("directions_changed",()=>{M.value.getDirections()}),F(p.value,n.value,I.value,M.value)},1e3)},K=()=>{var h=[];for(let g=0;g<r.value.length;g++){const V=r.value[g];h[g]={location:V.marker_position}}return h},F=(h,g,V,z)=>{V.route({origin:h,destination:g,waypoints:K(),travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(S=>{console.log(S);const m=U(S);k.value=m,x.value={path:m,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(S=>{alert("Could not display directions due to: "+S)})},U=h=>{const g=h.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(g).map(z=>({lat:z.lat(),lng:z.lng()}))};return ht(()=>{t.value={lat:v.value.position.start_latitude,lng:v.value.position.start_longitude},p.value=t.value,n.value={lat:v.value.position.end_latitude,lng:v.value.position.end_longitude},A()}),{markerClicked:h=>{o("markerclicked",h)},map:u,markers:r,mapCenter:t,mapZoom:D,polylinePath:x,routeCoordinates:k,polylineOptions:w}},props:["system_setting","route","conf"]},Pt={class:"w-full overflow-auto"},Tt={style:{"text-align":"center"}},Dt=["src"];function Vt(f,o,u,t,D,r){const x=y("Polyline"),k=y("CustomMarker"),w=y("GoogleMap");return s(),a("div",Pt,[t.mapCenter?(s(),O(w,{"api-key":u.system_setting.google_map_api,ref:"map",center:t.mapCenter,key:`${t.mapCenter.lat},${t.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:t.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:j(()=>[P(x,{options:t.polylinePath},null,8,["options"]),(s(!0),a(W,null,q(t.markers,(v,b)=>(s(),O(k,{options:{position:v.marker_position},onClick:d=>t.markerClicked(v)},{default:j(()=>[e("div",Tt,[e("img",{src:v.icon,width:"40",class:"rounded-full",height:"40",style:{"margin-top":"8px"}},null,8,Dt)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):c("",!0)])}const Rt=lt(St,[["render",Vt]]),Mt=B(()=>G(()=>import("./map-CbOzg2Wr.min.js"),__vite__mapDeps([0,1,2]))),zt=B(()=>G(()=>import("./side-form-create-B2Ekk4lj.min.js"),__vite__mapDeps([3,1,2,4,5]))),Et=B(()=>G(()=>import("./side-form-update-Bpfkw8M2.min.js"),__vite__mapDeps([6,1,2,4,5,7,8]))),Ot=B(()=>G(()=>import("./form_field-DiE37Nzp.min.js"),__vite__mapDeps([7,1,2,4,5,8]))),At={components:{datatabble:dt,SideFormCreate:zt,SideFormUpdate:Et,maps:Mt,close_icon:gt,delete_icon:ct,car_icon:rt,route_icon:it,form_field:Ot,editable_map_location:ut,drivers_locations_map:It,route_map:Rt},name:"Routes",emits:["callback"],setup(f,{emit:o}){const u=_(!1),t=_(!1),D=_(!1),r=_({}),x=_("Info"),k=_({}),w=_({}),v=_(""),b=_(null),d=_(!1),p=_(["Info","Time","Start location","End location","Driver","Supervisor","Confirm"]),n=_([]),I=_(!1),M=_(""),A=_("");f.active_tab&&(x.value=f.active_tab),f.item&&(r.value=f.item,r.value.position=f.item.position??{});const K=i=>{r.value.driver_id=i.driver_id,r.value.driver=i,F(i.vehicle)},F=i=>{console.log(i),r.value.vehicle_id=i.vehicle_id,r.value.vehicle=i,v.value=null},U=async()=>{navigator.geolocation&&!r.value.route_id?navigator.geolocation.getCurrentPosition(i=>{r.value.position.start_latitude=i.coords.latitude,r.value.position.start_longitude=i.coords.longitude,r.value.position.end_latitude=i.coords.latitude,r.value.position.end_longitude=i.coords.longitude},i=>{r.value.position.start_latitude=r.value.position.start_latitude??30.06,r.value.position.start_longitude=r.value.position.start_longitude??31.21,r.value.position.end_latitude=r.value.position.end_latitude??30.06,r.value.position.end_longitude=r.value.position.end_longitude??31.21,tt(i.message)}):b.value="Geolocation is not supported by this browser."};U();const H=async()=>{let i=M.value.length>3?await st(f.system_setting.google_map_api,M.value,f.business_setting.country):"";n.value=i.predictions},h=async()=>{let i=A.value.length>3?await st(f.system_setting.google_map_api,A.value,f.business_setting.country):"";n.value=i.predictions},g=async()=>{u.value=!0;var i=new URLSearchParams;let C=JSON.parse(JSON.stringify(r.value)),J=Object.keys(C),T,Z;for(let R=0;R<J.length;R++)T=J[R],Z=typeof C[T]=="object"?JSON.stringify(C[T]):C[T],i.append("params["+T+"]",Z);let $=C.route_id>0?"update":"create";i.append("type","Route."+$),await xt(i,"/api/"+$).then(R=>{u.value=!1,pt(R)})},V=async i=>{r.value.position.start_latitude=i.lat(),r.value.position.start_longitude=i.lng(),r.value.position.start_address=await nt(i.lat(),i.lng())},z=async i=>{r.value.position.end_latitude=i.lat(),r.value.position.end_longitude=i.lng(),r.value.position.end_address=await nt(i.lat(),i.lng())},S=async(i,C)=>{const J=new google.maps.places.PlacesService(document.createElement("div"));let T=i.place_id;J.getDetails({placeId:T},(Z,$)=>{if($===google.maps.places.PlacesServiceStatus.OK&&Z){const R=Z.geometry.location;C=="start"&&(r.value.position.start_address=i.description,r.value.position.start_latitude=R.lat(),r.value.position.start_longitude=R.lng()),C=="end"&&(r.value.position.end_address=i.description,r.value.position.end_latitude=R.lat(),r.value.position.end_longitude=R.lng()),n.value=[],I.value=!1}else console.error("Failed to fetch place details")})},m=()=>{o("callback")},N=(i,C)=>{const J=r.value[C];for(let T=0;T<i.length;T++)if(i[T][C]==J)return i[T];return{}},Q=i=>{i&&i.model&&tt(i.model.name+` 
\r `+i.start_address)},Y=()=>bt(["route_name","description","morning_trip_time","afternoon_trip_time","start_address","end_address","driver_id","vehicle_id","status"],r),et=()=>{if(f.drivers)for(let i=0;i<f.drivers.length;i++)f.drivers[i].show=v.value.trim()?X(f.drivers[i]):1},X=i=>{let C=!!i.name.toLowerCase().includes(v.value.toLowerCase());return C||!!i.mobile.toLowerCase().includes(v.value.toLowerCase())};return{loader:u,showPlaceSearch:I,findDriver:et,setDriver:K,setVehicle:F,markerClicked:Q,progressWidth:Y,selectedObject:N,setPlaceMarker:S,startPlaceChanged:H,endPlaceChanged:h,start_placeSearch:M,end_placeSearch:A,places:n,showAddSide:t,showEditSide:D,content:k,fillable:p,center:w,activeItem:r,activeTab:x,translate:_t,updateStartMarker:V,updateEndMarker:z,searchText:v,getUserLocation:U,collapsed:d,saveRoute:g,back:m}},props:["conf","path","system_setting","business_setting","setting","item","drivers","vehicles","supervisors","active_tab"]},Lt={class:"w-full overflow-auto"},Nt={class:"w-full relative"},jt={class:"card w-full py-10"},Wt={class:"w-full stepper stepper-links"},qt={class:"stepper-nav justify-content-center py-2 mb-10"},Ft=["onClick"],Ut=["textContent"],Jt={class:"w-full"},Bt={class:"card-body pt-0"},Gt={class:"settings-form"},Kt={class:"max-w-xl mb-6 mx-auto row"},Zt=["for","textContent"],Ht=["placeholder"],Qt=["for","textContent"],Yt=["placeholder"],Xt={class:"text-center mt-10"},$t=["textContent"],te={class:"card-body pt-0"},ee={class:"settings-form"},oe={class:"max-w-xl mb-6 mx-auto row"},ne=["textContent"],se=["placeholder"],le=["textContent"],ae=["placeholder"],ie={class:"text-center mt-10"},re=["textContent"],ce={class:"card-body pt-0"},de={class:"settings-form"},_e={class:"px-10 mb-6 mx-auto row"},ue={class:"flex w-full"},me={class:"mt-10 w-full"},ve=["textContent"],fe={class:"fw-semibold text-gray-600 fs-6"},he=["textContent"],ge=["textContent"],xe=["placeholder"],pe={class:"w-full"},be={key:0,class:"d-flex align-items-center mb-8"},ye=["onClick"],Ce=["onClick"],ke=["textContent"],we=["textContent"],Ie={class:"w-full"},Se={class:"text-center mt-10"},Pe=["textContent"],Te={class:"card-body pt-0"},De={class:"px-10 mb-6 mx-auto row"},Ve={class:"flex w-full"},Re={class:"mt-10 w-full"},Me=["textContent"],ze={class:"fw-semibold text-gray-600 fs-6"},Ee=["textContent"],Oe=["textContent"],Ae=["placeholder"],Le={class:"w-full"},Ne={key:0,class:"d-flex align-items-center mb-8"},je=["onClick"],We=["onClick"],qe=["textContent"],Fe=["textContent"],Ue={class:"w-full"},Je={class:"text-center mt-10"},Be=["textContent"],Ge={class:"card-body pt-0"},Ke={class:"settings-form flex w-full"},Ze={class:"w-full"},He={class:"w-full mb-6 mx-auto row"},Qe={class:"text-center mb-13"},Ye=["textContent"],Xe=["textContent"],$e={class:"w-100 relative mb-5",autocomplete:"off"},to=["placeholder"],eo={class:"w-full"},oo={class:"symbol symbol-35px symbol-circle me-5"},no=["src"],so={class:"fw-semibold w-full"},lo=["textContent"],ao=["textContent"],io=["onClick","textContent"],ro={class:"symbol symbol-35px symbol-circle me-5"},co=["src"],_o={class:"fw-semibold w-full"},uo=["textContent"],mo=["textContent"],vo={key:0,class:"text-gray-600 fw-semibold flex flex-column-auto gap-2"},fo=["textContent"],ho=["textContent"],go=["textContent"],xo={class:"text-center mt-10"},po=["textContent"],bo={class:"card-body pt-0"},yo={class:"settings-form"},Co={class:"max-w-xl mb-6 mx-auto row"},ko={class:"text-center mb-13"},wo=["textContent"],Io=["textContent"],So=["textContent"],Po={class:"text-center mt-10"},To=["textContent"],Do={class:"w-full flex gap-10"},Vo={class:"w-full"},Ro={class:"w-full"},Mo={class:"bg-gray-200 shadow-md mb-10 rounded-xl"},zo={class:"card-header border-0 pt-9"},Eo={key:0,class:"card-title m-0 flex gap-4"},Oo={class:"symbol symbol-50px w-50px bg-light"},Ao=["src"],Lo=["textContent"],No={class:"flex gap-2 cursor-pointer"},jo={class:"pt-3"},Wo=["textContent"],qo={key:0,class:"card-body p-9"},Fo=["textContent"],Uo=["textContent"],Jo={class:"timeline timeline-border-dashed"},Bo={class:"timeline-item"},Go={class:"timeline-icon me-4"},Ko={class:"timeline-content mb-10 mt-n2"},Zo={class:"overflow-auto pe-3"},Ho=["textContent"],Qo={class:"d-flex align-items-center mt-1 fs-6"},Yo=["textContent"],Xo={class:"timeline-item"},$o={class:"timeline-icon me-4"},tn={class:"timeline-content mb-10 mt-n2"},en={class:"overflow-auto pe-3"},on=["textContent"],nn={class:"d-flex align-items-center mt-1 fs-6"},sn=["textContent"],ln={class:"h-4px w-100 bg-light mb-5"},an={key:0,class:"w-full flex gap-4"},rn={key:0,class:"w-full flex gap-4"},cn={class:"block gap-4"},dn=["textContent"],_n=["textContent"],un={key:1,class:"w-full block gap-4"},mn=["textContent"],vn=["textContent"],fn={key:2,class:"w-full block gap-4"},hn={class:"w-full block gap-4"},gn=["textContent"],xn=["textContent"],pn={class:"text-center mt-10"},bn=["textContent"];function yn(f,o,u,t,D,r){const x=y("close_icon"),k=y("editable_map_location"),w=y("drivers_locations_map"),v=y("vue-feather"),b=y("car_icon"),d=y("form_field"),p=y("route_map");return s(),a("div",Lt,[t.loader?(s(),a("div",{key:t.loader,class:"bg-white fixed w-full h-full top-0 left-0",style:{"z-index":"99999",opacity:".9"}},[...o[20]||(o[20]=[e("img",{class:"m-auto w-500px",src:"/uploads/loader.gif"},null,-1)])])):c("",!0),e("div",Nt,[P(x,{class:"absolute top-4 right-4 z-10 cursor-pointer",onClick:t.back},null,8,["onClick"]),e("div",jt,[e("div",Wt,[e("div",qt,[(s(!0),a(W,null,q(t.fillable,n=>(s(),a("div",{class:"stepper-item",onClick:I=>t.activeTab=n},[e("h3",{class:at([t.activeTab==n?"text-danger border-danger":"text-gray-400 border-transparent","cursor-pointer pb-3 px-2 stepper-title text-md border-b"]),textContent:l(t.translate(n))},null,10,Ut)],8,Ft))),256))]),e("div",Jt,[t.activeTab=="Info"?(s(),a("div",{class:"",key:t.activeTab},[e("div",Bt,[e("div",Gt,[e("div",Kt,[o[21]||(o[21]=e("input",{name:"params[route_id]",type:"hidden"},null,-1)),e("label",{class:"col-lg-4 col-form-label required fw-semibold fs-6",for:"input"+f.i,textContent:l(t.translate("Route name"))},null,8,Zt),E(e("input",{required:!0,autocomplete:"off",name:"params[name]",class:"form-control form-control-solid",placeholder:t.translate("Route name"),"onUpdate:modelValue":o[0]||(o[0]=n=>t.activeItem.route_name=n)},null,8,Ht),[[L,t.activeItem.route_name]]),o[22]||(o[22]=e("hr",{class:"block mt-6 my-2 opacity-10"},null,-1)),e("label",{class:"col-lg-4 col-form-label required fw-semibold fs-6",for:"input"+f.i,textContent:l(t.translate("Description"))},null,8,Qt),E(e("textarea",{required:!0,autocomplete:"off",name:"params[description]",class:"form-control form-control-solid",placeholder:t.translate("Description"),"onUpdate:modelValue":o[1]||(o[1]=n=>t.activeItem.description=n)}," ",8,Yt),[[L,t.activeItem.description]])])])]),e("p",Xt,[e("a",{href:"javascript:;",class:"uppercase px-4 py-3 mx-2 text-center text-white rounded-lg bg-danger",onClick:o[2]||(o[2]=n=>t.activeTab="Time"),textContent:l(t.translate("Next"))},null,8,$t)])])):c("",!0),t.activeTab=="Time"?(s(),a("div",{class:"",key:t.activeTab},[e("div",te,[e("div",ee,[e("div",oe,[e("label",{class:"col-lg-4 col-form-label required fw-semibold fs-6",textContent:l(t.translate("Morning trip time"))},null,8,ne),E(e("input",{required:!0,autocomplete:"off",name:"params[morning_trip_time]",class:"form-control form-control-solid",placeholder:t.translate("Morning Trip time"),type:"time","onUpdate:modelValue":o[3]||(o[3]=n=>t.activeItem.morning_trip_time=n)},null,8,se),[[L,t.activeItem.morning_trip_time]]),o[23]||(o[23]=e("hr",{class:"block mt-6 my-2 opacity-10"},null,-1)),e("label",{class:"col-lg-4 col-form-label required fw-semibold fs-6",textContent:l(t.translate("Afternoon trip time"))},null,8,le),E(e("input",{required:!0,autocomplete:"off",name:"params[afternoon_trip_time]",class:"form-control form-control-solid",placeholder:t.translate("Afternoon Trip time"),type:"time","onUpdate:modelValue":o[4]||(o[4]=n=>t.activeItem.afternoon_trip_time=n)},null,8,ae),[[L,t.activeItem.afternoon_trip_time]])])])]),e("p",ie,[e("a",{href:"javascript:;",class:"uppercase px-4 py-3 mx-2 text-center text-white rounded-lg bg-danger",onClick:o[5]||(o[5]=n=>t.activeTab="Start location"),textContent:l(t.translate("Next"))},null,8,re)])])):c("",!0),t.activeTab=="Start location"?(s(),a("div",{class:"",key:t.activeTab},[e("div",ce,[e("div",de,[e("div",_e,[e("div",ue,[e("div",me,[e("h3",{class:"mb-3",textContent:l(t.translate("Location Address"))},null,8,ve),e("div",fe,[(s(),a("span",{class:"d-block fw-bold pb-3 text-gray-400",key:t.activeItem.position.start_address,textContent:l(t.activeItem.position.start_address)},null,8,he)),e("a",{class:"fw-bold",onClick:o[6]||(o[6]=n=>t.showPlaceSearch=!0),href:"javascript:;",textContent:l(t.translate("Change"))},null,8,ge)]),t.showPlaceSearch?(s(),a("div",{key:t.showPlaceSearch},[E(e("input",{autocomplete:"off",onChange:o[7]||(o[7]=(...n)=>t.startPlaceChanged&&t.startPlaceChanged(...n)),"onUpdate:modelValue":o[8]||(o[8]=n=>t.start_placeSearch=n),type:"text",class:"form-control form-control-solid",placeholder:t.translate("Find Location")},null,40,xe),[[L,t.start_placeSearch]]),t.places?(s(),a("div",{class:"mt-3 w-full card-body",key:t.places},[(s(!0),a(W,null,q(t.places,n=>(s(),a("div",pe,[n?(s(),a("div",be,[o[25]||(o[25]=e("span",{class:"bullet bullet-vertical h-40px bg-success"},null,-1)),e("div",{class:"form-check form-check-custom form-check-solid mx-5 cursor-pointer",onClick:I=>t.setPlaceMarker(n,"start")},[...o[24]||(o[24]=[e("input",{class:"form-check-input",type:"checkbox",value:""},null,-1)])],8,ye),e("div",{class:"flex-grow-1 cursor-pointer",onClick:I=>t.setPlaceMarker(n,"start")},[n.structured_formatting?(s(),a("a",{key:0,href:"#",class:"text-gray-800 text-hover-primary fw-bold fs-6",textContent:l(n.structured_formatting.main_text)},null,8,ke)):c("",!0),e("span",{class:"text-muted fw-semibold d-block",textContent:l(n.description)},null,8,we)],8,Ce),o[26]||(o[26]=e("span",{class:"badge badge-light-success fs-8 fw-bold"},null,-1))])):c("",!0)]))),256))])):c("",!0)])):c("",!0)]),e("div",Ie,[(s(),O(k,{system_setting:u.system_setting,item:t.activeItem.position,onSetlocation:t.updateStartMarker,key:t.activeItem.position.start_latitude,location:{lat:t.activeItem.position.start_latitude,lng:t.activeItem.position.start_longitude}},null,8,["system_setting","item","onSetlocation","location"]))])])])])]),e("p",Se,[e("a",{href:"javascript:;",class:"uppercase px-4 py-3 mx-2 text-center text-white rounded-lg bg-danger",onClick:o[9]||(o[9]=n=>t.activeTab="End location"),textContent:l(t.translate("Next"))},null,8,Pe)])])):c("",!0),t.activeTab=="End location"?(s(),a("div",{class:"",key:t.activeTab},[e("div",Te,[e("div",De,[e("div",Ve,[e("div",Re,[e("h3",{class:"mb-3",textContent:l(t.translate("Location Address"))},null,8,Me),e("div",ze,[(s(),a("span",{class:"d-block fw-bold pb-3 text-gray-400",key:t.activeItem.position.end_address,textContent:l(t.activeItem.position.end_address)},null,8,Ee)),e("a",{class:"fw-bold",onClick:o[10]||(o[10]=n=>t.showPlaceSearch=!0),href:"javascript:;",textContent:l(t.translate("Change"))},null,8,Oe)]),t.showPlaceSearch?(s(),a("div",{key:t.showPlaceSearch},[E(e("input",{autocomplete:"off",onChange:o[11]||(o[11]=(...n)=>t.endPlaceChanged&&t.endPlaceChanged(...n)),"onUpdate:modelValue":o[12]||(o[12]=n=>t.end_placeSearch=n),type:"text",class:"form-control form-control-solid",placeholder:t.translate("Find Location")},null,40,Ae),[[L,t.end_placeSearch]]),t.places&&t.end_placeSearch.length?(s(),a("div",{class:"mt-3 w-full card-body",key:t.places},[(s(!0),a(W,null,q(t.places,n=>(s(),a("div",Le,[n?(s(),a("div",Ne,[o[28]||(o[28]=e("span",{class:"bullet bullet-vertical h-40px bg-success"},null,-1)),e("div",{class:"form-check form-check-custom form-check-solid mx-5 cursor-pointer",onClick:I=>t.setPlaceMarker(n,"end")},[...o[27]||(o[27]=[e("input",{class:"form-check-input",type:"checkbox",value:""},null,-1)])],8,je),e("div",{class:"flex-grow-1 cursor-pointer",onClick:I=>t.setPlaceMarker(n,"end")},[n.structured_formatting?(s(),a("a",{key:0,href:"#",class:"text-gray-800 text-hover-primary fw-bold fs-6",textContent:l(n.structured_formatting.main_text)},null,8,qe)):c("",!0),e("span",{class:"text-muted fw-semibold d-block",textContent:l(n.description)},null,8,Fe)],8,We),o[29]||(o[29]=e("span",{class:"badge badge-light-success fs-8 fw-bold"},null,-1))])):c("",!0)]))),256))])):c("",!0)])):c("",!0)]),e("div",Ue,[(s(),O(k,{system_setting:u.system_setting,item:t.activeItem.position,onSetlocation:t.updateEndMarker,key:t.activeItem.position.end_latitude,location:{lat:t.activeItem.position.end_latitude,lng:t.activeItem.position.end_longitude}},null,8,["system_setting","item","onSetlocation","location"]))])])])]),e("p",Je,[e("a",{href:"javascript:;",class:"uppercase px-4 py-3 mx-2 text-center text-white rounded-lg bg-danger",onClick:o[13]||(o[13]=n=>t.activeTab="Driver"),textContent:l(t.translate("Next"))},null,8,Be)])])):c("",!0),t.activeTab=="Driver"?(s(),a("div",{class:"",key:t.activeTab},[e("div",Ge,[e("div",Ke,[e("div",Ze,[(s(),O(w,{setting:u.system_setting,item:t.activeItem,drivers:u.drivers,conf:u.conf,center:{lat:Number(t.activeItem.position.start_latitude),lng:Number(t.activeItem.position.start_longitude)},onSetdriver:t.setDriver,key:t.activeItem},null,8,["setting","item","drivers","conf","center","onSetdriver"]))]),e("div",He,[(s(),a("div",{class:"card-body pt-0 mx-auto max-w-xl",key:u.drivers},[e("div",Qe,[e("h1",{class:"mb-3",textContent:l(t.translate("Find Driver"))},null,8,Ye),e("div",{class:"text-gray-400 font-semibold",textContent:l(t.translate("Search by name or mobile"))},null,8,Xe)]),e("div",$e,[P(v,{type:"user",class:"text-gray-500 position-absolute top-50 ms-5 translate-middle-y"}),E(e("input",{type:"text",onChange:o[14]||(o[14]=(...n)=>t.findDriver&&t.findDriver(...n)),onInput:o[15]||(o[15]=(...n)=>t.findDriver&&t.findDriver(...n)),"onUpdate:modelValue":o[16]||(o[16]=n=>t.searchText=n),class:"form-control form-control-lg form-control-solid px-15",placeholder:t.translate("Search by name or mobile")},null,40,to),[[L,t.searchText]])]),t.searchText?(s(!0),a(W,{key:0},q(u.drivers,n=>(s(),a("div",eo,[n&&n.show?(s(),a("a",{href:"javascript:;",key:n.show,class:"d-flex align-items-center p-3 bg-gray-100 rounded-lg shadow-md mb-1"},[e("div",oo,[n.picture?c("",!0):(s(),O(b,{key:0})),n.picture?(s(),a("img",{key:1,alt:"Pic",src:n.picture},null,8,no)):c("",!0)]),e("div",so,[e("span",{class:"text-lg text-danger font-semibold me-2",textContent:l(n.name)},null,8,lo),e("span",{class:"block text-gray-500 text-sm",textContent:l(n.mobile)},null,8,ao)]),e("span",{onClick:I=>t.setDriver(n),class:"btn btn-danger btn-sm text-white",textContent:l(t.translate("Choose"))},null,8,io)])):c("",!0)]))),256)):c("",!0),t.activeItem.driver?(s(),a("a",{href:"javascript:;",key:t.activeItem.driver,class:"d-flex align-items-center p-3 bg-gray-100 rounded-lg shadow-md mb-1 gap-4"},[e("div",ro,[t.activeItem.driver.picture?c("",!0):(s(),O(b,{key:0})),t.activeItem.driver.picture?(s(),a("img",{key:1,alt:"Pic",src:t.activeItem.driver.picture},null,8,co)):c("",!0)]),e("div",_o,[e("span",{class:"text-lg text-danger font-semibold me-2",textContent:l(t.activeItem.driver.name)},null,8,uo),e("span",{class:"block text-gray-500 text-sm truncate",textContent:l(t.activeItem.driver.mobile)},null,8,mo)]),t.activeItem.vehicle?(s(),a("div",vo,[P(v,{type:"truck"}),e("span",{textContent:l(t.activeItem.vehicle.plate_number),class:"text-md font-semibold me-2 flex-column-auto"},null,8,fo)])):c("",!0)])):c("",!0),e("p",{class:"mt-4 py-2 fw-semibold px-4 border border-gray-400",textContent:l(t.translate("You can change the vehicle of the driver for this route only"))},null,8,ho),e("label",{class:"col-lg-4 col-form-label required fw-semibold fs-6",textContent:l(t.translate("Vehicles"))},null,8,go),P(d,{onCallback:t.setVehicle,item:t.activeItem,column:{key:"vehicle_id",title:t.translate("Vehicle"),text_key:"vehicle_name",column_type:"select",data:u.vehicles}},null,8,["onCallback","item","column"])]))])])]),e("p",xo,[e("a",{href:"javascript:;",class:"uppercase px-4 py-3 mx-2 text-center text-white rounded-lg bg-danger",onClick:o[17]||(o[17]=n=>t.activeTab="Supervisor"),textContent:l(t.translate("Next"))},null,8,po)])])):c("",!0),t.activeTab=="Supervisor"?(s(),a("div",{class:"w-full mx-auto",key:t.activeTab},[e("div",bo,[e("div",yo,[e("div",Co,[e("div",ko,[e("h1",{class:"mb-3",textContent:l(t.translate("Select Supervisor"))},null,8,wo),e("div",{class:"text-gray-400 font-semibold",textContent:l(t.translate("Assigned spervisor should have location"))},null,8,Io)]),e("label",{class:"col-lg-4 col-form-label required fw-semibold fs-6",textContent:l(t.translate("Supervisor"))},null,8,So),P(d,{item:t.activeItem,column:{key:"supervisor_id",title:t.translate("Supervisor"),text_key:"name",column_type:"select",data:u.supervisors}},null,8,["item","column"]),o[30]||(o[30]=e("hr",{class:"block mt-6 my-2 opacity-10"},null,-1))])])]),e("p",Po,[e("a",{href:"javascript:;",class:"uppercase px-4 py-3 mx-2 text-center text-white rounded-lg bg-danger",onClick:o[18]||(o[18]=n=>t.activeTab="Confirm"),textContent:l(t.translate("Next"))},null,8,To)])])):c("",!0),t.activeTab=="Confirm"?(s(),a("div",{class:"w-full mx-auto",key:t.activeTab},[e("div",Do,[e("div",Vo,[P(p,{onMarkerclicked:t.markerClicked,class:"rounded-xl shadow-md mx-4",system_setting:u.system_setting??u.setting,conf:u.conf,route:t.activeItem},null,8,["onMarkerclicked","system_setting","conf","route"])]),e("div",Ro,[o[34]||(o[34]=e("hr",{class:"block mt-6 my-2 opacity-10"},null,-1)),e("div",Mo,[e("div",zo,[t.activeItem.driver_id?(s(),a("div",Eo,[e("div",Oo,[e("img",{src:t.selectedObject(u.drivers,"driver_id").picture,alt:"image",class:"p-3"},null,8,Ao)]),e("span",{class:"",textContent:l(t.selectedObject(u.drivers,"driver_id").name)},null,8,Lo)])):c("",!0),e("label",No,[P(d,{class:"flex-end",item:t.activeItem,column:{key:"status",title:t.translate("Status"),column_type:"checkbox",hide_text:!0}},null,8,["item","column"]),e("div",jo,[e("span",{class:"badge badge-light fw-bold me-auto px-4 py-3",textContent:l(t.activeItem.status?"Active":"Pending")},null,8,Wo)])])]),t.activeItem?(s(),a("div",qo,[e("div",{class:"fs-3 fw-bold text-gray-900",textContent:l(t.activeItem.route_name)},null,8,Fo),e("p",{class:"text-gray-500 fw-semibold fs-5 mt-1 mb-7",textContent:l(t.activeItem.description)},null,8,Uo),e("div",Jo,[e("div",Bo,[o[31]||(o[31]=e("div",{class:"timeline-line"},null,-1)),e("div",Go,[P(v,{type:"circle",class:"fs-2 text-success"})]),e("div",Ko,[e("div",Zo,[t.activeItem.position?(s(),a("div",{key:0,class:"fs-5 fw-semibold mb-2",textContent:l(t.activeItem.position.start_address)},null,8,Ho)):c("",!0),e("div",Qo,[e("div",{class:"text-muted me-2 fs-7",textContent:l(t.translate("Pickup"))},null,8,Yo)])])])]),e("div",Xo,[o[32]||(o[32]=e("div",{class:"timeline-line"},null,-1)),e("div",$o,[P(v,{type:"map-pin",class:"fs-2 text-danger"})]),e("div",tn,[e("div",en,[t.activeItem.position?(s(),a("div",{key:0,class:"fs-5 fw-semibold mb-2",textContent:l(t.activeItem.position.end_address)},null,8,on)):c("",!0),e("div",nn,[e("div",{class:"text-muted me-2 fs-7",textContent:l(t.translate("Destination"))},null,8,sn)])])])])]),e("div",ln,[e("div",{class:at(["rounded h-4px transition transition-all",t.progressWidth()<100?"bg-info":"bg-success"]),role:"progressbar",style:ot({width:t.progressWidth()+"%"})},null,6)]),t.activeItem.vehicle_id?(s(),a("div",an,[t.activeItem.vehicle_id?(s(),a("div",rn,[o[33]||(o[33]=e("img",{src:"/uploads/images/car.svg",class:"w-10"},null,-1)),e("div",cn,[e("span",{class:"w-full block font-semibold",textContent:l(t.translate("Vehicle"))},null,8,dn),e("span",{class:"w-full block",textContent:l(t.selectedObject(u.vehicles,"vehicle_id").plate_number)},null,8,_n)])])):c("",!0),t.activeItem.morning_trip_time?(s(),a("div",un,[e("span",{class:"w-full block font-semibold",textContent:l(t.translate("Morning trip"))},null,8,mn),e("span",{class:"w-full block",textContent:l(t.activeItem.morning_trip_time)},null,8,vn)])):c("",!0),t.activeItem.afternoon_trip_time?(s(),a("div",fn,[e("div",hn,[e("span",{class:"w-full block font-semibold",textContent:l(t.translate("Afternoon trip"))},null,8,gn),e("span",{class:"w-full block",textContent:l(t.activeItem.afternoon_trip_time)},null,8,xn)])])):c("",!0)])):c("",!0)])):c("",!0)])])]),e("p",pn,[e("a",{href:"javascript:;",class:"uppercase px-4 py-3 mx-2 text-center text-white rounded-lg bg-danger",onClick:o[19]||(o[19]=(...n)=>t.saveRoute&&t.saveRoute(...n)),textContent:l(t.translate("Submit"))},null,8,bn)])])):c("",!0)])])])])])}const Cn=lt(At,[["render",yn]]),kn=B(()=>G(()=>import("./map-CbOzg2Wr.min.js"),__vite__mapDeps([0,1,2]))),wn=B(()=>G(()=>import("./form_field-DiE37Nzp.min.js"),__vite__mapDeps([7,1,2,4,5,8]))),In={components:{datatabble:dt,maps:kn,delete_icon:ct,car_icon:rt,route_icon:it,form_field:wn,editable_map_location:ut,route_wizard:Cn,tooltip:yt},name:"Routes",setup(f){const o=f.conf.url+f.path+"?load=json",u=_(!1),t=_({}),D=_({}),r=_({}),x=_(!1),k=_(["Info","Time","Start location","End location","Driver"]),w=_([]),v=_(!1),b=_(""),d=_(""),p=_("#"),n=_(null),I=()=>{u.value=!1};(()=>{kt(o).then(m=>{D.value=JSON.parse(JSON.stringify(m)),p.value=D.value.columns[1].value})})();const A=async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(m=>{t.value.start_latitude=m.coords.latitude,t.value.start_longitude=m.coords.longitude,t.value.end_latitude=m.coords.latitude,t.value.end_longitude=m.coords.longitude},m=>{t.value.start_latitude=30.06,t.value.start_longitude=31.21,t.value.end_latitude=30.06,t.value.end_longitude=31.21,tt(m.message)}):tt("location error")},K=()=>{t.value={},x.value=!0,A()},F=async()=>{let m=b.value.length>3?await st(f.system_setting.google_map_api,b.value,f.business_setting.country):"";w.value=m.predictions},U=async m=>{t.value.start_latitude=m.lat(),t.value.start_longitude=m.lng(),t.value.start_address=await nt(m.lat(),m.lng())},H=m=>{t.value.end_latitude=m.lat(),t.value.end_longitude=m.lng()},h=(m,N,Q)=>{},g=(m,N)=>{switch(t.value=N,m){case"view":break;case"edit":n.value="Info",x.value=!0;break;case"locations":n.value="Confirm",x.value=!0;break;case"driver":n.value="Driver",x.value=!0;break;case"delete":wt("route_id",N,"Route.delete");break;case"close":u.value=!1,t.value={};break}},V=_([]),z=async m=>{t.value.start_address=m.description;const N=new google.maps.places.PlacesService(document.createElement("div"));let Q=m.place_id;N.getDetails({placeId:Q},(Y,et)=>{if(et===google.maps.places.PlacesServiceStatus.OK&&Y){const X=Y.geometry.location;t.value.start_longitude=X.lng(),t.value.start_latitude=X.lat(),w.value=[],v.value=!1}else console.error("Failed to fetch place details")})},S=_({});return{showWizard:x,showTip:S,defaultTab:n,showPlaceSearch:v,start_placeSearch:b,places:w,waypoints:V,showEditSide:u,url:o,content:D,fillable:k,center:r,activeItem:t,searchValue:d,searchField:p,setPlaceMarker:z,startPlaceChanged:F,translate:_t,clickMarker:h,updateStartMarker:U,updateEndMarker:H,getUserLocation:A,closeSide:I,addRouteWizard:K,handleAction:g}},props:["path","lang","system_setting","business_setting","setting","conf","auth"]},Sn={class:"w-full flex overflow-auto"},Pn={key:0,class:"w-full relative"},Tn={key:1,class:""},Dn={class:"card"},Vn={class:"card-body"},Rn={class:"card-px text-center pt-15 pb-15"},Mn=["textContent"],zn=["textContent"],En=["textContent"],On={key:2,class:"flex-1 overflow-x-hidden overflow-y-auto w-full relative"},An={class:"px-4 mb-6 py-4 rounded-lg shadow-md bg-white dark:bg-gray-700 flex w-full"},Ln=["textContent"],Nn={class:"w-full bg-white"},jn={class:"card-header align-items-center py-5 gap-2 gap-md-5 w-full flex px-4"},Wn={class:"card-title"},qn={class:"d-flex align-items-center position-relative my-1"},Fn={class:"card-toolbar flex-row-fluid justify-content-end gap-5"},Un={class:"w-150px"},Jn=["textContent","value"],Bn=["textContent"],Gn=["src"],Kn=["onClick"],Zn=["src"],Hn=["textContent"],Qn=["onClick"],Yn=["src"],Xn=["textContent"],$n=["onClick"],ts=["onClick"];function es(f,o,u,t,D,r){const x=y("route_wizard"),k=y("route_icon"),w=y("vue-feather"),v=y("delete_icon"),b=y("datatabble");return s(),a("div",Sn,[t.content?(s(),a("div",Pn,[t.showWizard?(s(),O(x,{onCallback:o[0]||(o[0]=d=>t.showWizard=!1),key:t.showWizard,active_tab:t.defaultTab,drivers:t.content.drivers,supervisors:t.content.supervisors,vehicles:t.content.vehicles,system_setting:u.system_setting,item:t.activeItem,business_setting:u.business_setting,conf:u.conf},null,8,["active_tab","drivers","supervisors","vehicles","system_setting","item","business_setting","conf"])):c("",!0),!t.showWizard&&t.content.items&&!t.content.items.length?(s(),a("div",Tn,[e("div",Dn,[e("div",Vn,[e("div",Rn,[e("h2",{class:"fs-2x fw-bold mb-0",textContent:l(t.content.title)},null,8,Mn),e("p",{class:"text-gray-400 fs-4 font-semibold py-7",textContent:l(t.translate("Add your first route using this below wizard"))},null,8,zn),e("a",{textContent:l(t.translate("add_new")),onClick:o[1]||(o[1]=(...d)=>t.addRouteWizard&&t.addRouteWizard(...d)),href:"javascript:;",class:"text-white btn btn-primary er fs-6 px-8 py-4"},null,8,En)]),o[5]||(o[5]=e("div",{class:"text-center pb-15 px-5"},[e("img",{src:"/uploads/img/start-wizard.png",alt:"",class:"mx-auto mw-100 h-200px h-sm-325px"})],-1))])])])):c("",!0),t.content.items&&!t.showWizard?(s(),a("main",On,[e("div",An,[e("h1",{class:"font-bold text-lg w-full",textContent:l(t.content.title)},null,8,Ln)]),e("div",Nn,[e("div",jn,[e("div",Wn,[e("div",qn,[E(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=d=>t.searchValue=d),"data-kt-ecommerce-order-filter":"search",class:"form-control form-control-solid w-250px ps-12",placeholder:"Search Report"},null,512),[[L,t.searchValue]])])]),e("div",Fn,[e("div",Un,[E(e("select",{"onUpdate:modelValue":o[3]||(o[3]=d=>t.searchField=d),class:"form-select form-select-solid select2-hidden-accessible","data-control":"select2","data-hide-search":"true","data-placeholder":"Rating","data-kt-ecommerce-order-filter":"rating","data-select2-id":"select2-data-9-zple",tabindex:"-1","aria-hidden":"true","data-kt-initialized":"1"},[(s(!0),a(W,null,q(t.content.columns,d=>(s(),a("option",{textContent:l(d.text),value:d.value},null,8,Jn))),256))],512),[[Ct,t.searchField]])])]),t.showWizard?c("",!0):(s(),a("a",{key:0,href:"javascript:;",class:"uppercase p-2 mx-2 text-center text-white w-32 rounded-lg bg-danger",onClick:o[4]||(o[4]=(...d)=>t.addRouteWizard&&t.addRouteWizard(...d)),textContent:l(t.translate("add_new"))},null,8,Bn))]),t.content.columns?(s(),O(b,{key:0,"search-field":t.searchField,"search-value":t.searchValue,alternating:"",class:"align-middle fs-6 gy-5 table table-row-dashed px-6","body-text-direction":t.translate("is_rtl"),"fixed-checkbox":"",headers:t.content.columns,items:t.content.items},{"item-picture":j(d=>[e("img",{src:d.picture,class:"w-8 h-8 rounded-full"},null,8,Gn)]),"item-route_locations":j(d=>[e("div",{class:"w-full h-8 relative flex cursor-pointer",onClick:p=>t.handleAction("locations",d)},[(s(!0),a(W,null,q(d.route_locations,(p,n)=>(s(),a("div",{style:ot("left: "+20*n+"px"),class:"rounded-full w-8 h-8 left-0 top-0 absolute"},[n<3?(s(),a("img",{key:n,class:"rounded-full w-8 h-8 rounded-[50px] border-2 border-purple-800",src:p.student&&p.student.picture?p.student.picture:"/uploads/images/default_profile.png"},null,8,Zn)):c("",!0)],4))),256)),e("span",{class:"flex absolute pt-2",style:ot("left: "+(20*(d.route_locations.length<3?d.route_locations.length:3)+20)+"px")},[P(k),d.route_locations?(s(),a("span",{key:0,class:"font-semibold px-1",textContent:l(d.route_locations.length)},null,8,Hn)):c("",!0)],4)],8,Kn)]),"item-driver":j(d=>[e("div",{class:"w-full relative flex cursor-pointer gap-2",onClick:p=>t.handleAction("driver",d)},[e("img",{class:"rounded-full w-8 h-8 rounded-[50px] border-2 border-purple-800",src:d.driver&&d.driver.picture?d.driver.picture:"/uploads/images/default_profile.png"},null,8,Yn),d.driver?(s(),a("span",{key:0,class:"font-semibold px-1",textContent:l(d.driver.name)},null,8,Xn)):c("",!0)],8,Qn)]),"item-edit":j(d=>[d.not_editable?c("",!0):(s(),a("button",{key:0,class:"p-2 hover:text-gray-600 text-purple",onClick:p=>t.handleAction("edit",d)},[P(w,{class:"w-5",type:"edit"})],8,$n))]),"item-delete":j(d=>[d.not_removeable?c("",!0):(s(),a("button",{key:0,class:"p-2 hover:text-gray-600 text-red-500",onClick:p=>t.handleAction("delete",d)},[P(v,{class:"w-5"})],8,ts))]),_:1},8,["search-field","search-value","body-text-direction","headers","items"])):c("",!0)])])):c("",!0)])):c("",!0)])}const ls=lt(In,[["render",es]]);export{ls as default};
