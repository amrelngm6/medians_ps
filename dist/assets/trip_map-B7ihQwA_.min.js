import{_ as V,r as n,U as B,a as y,o as g,c as C,y as w,O as M,g as S,F as T,f as F,d as x,b as L,ai as E}from"./index.min.js";import{O as G,L as I,j as W}from"./index.es-BqyRJkQ3.min.js";const $={components:{GoogleMap:G,Polyline:I,CustomMarker:W},emits:["markerclicked"],setup(p,{emit:h}){const v=n(null),a=n(null),f=n(12),c=n([]),d=n([]),m=n([]),_=n({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),r=n(p.trip),k=(l,t="lat",e="lng",o)=>{let s=JSON.parse(JSON.stringify(l));return s.icon=p.conf.url+"uploads/images/"+o,s.marker_position={lat:parseFloat(l[t]),lng:parseFloat(l[e])},s.drag=!1,s};(()=>{c.value=[k(r.value,"pickup_latitude","pickup_longitude","car.svg")],c.value[c.value.length]=k(r.value,"destination_latitude","destination_longitude","destination.svg")})();const i=n({lat:0,lng:0}),u=n({lat:0,lng:0}),D=l=>{const t=n(null),e=n(null);t.value=new google.maps.DirectionsService,e.value=new google.maps.DirectionsRenderer({draggable:!0,map,panel:document.getElementById("panel")}),e.value.addListener("directions_changed",()=>{const o=e.value.getDirections();o&&N(o)}),P("Perth, WA","Sydney, NSW",t.value,e.value)},P=(l,t,e,o)=>{e.route({origin:l,destination:t,waypoints:[{location:i.value.lat+","+i.value.lng},{location:u.value.lat+","+u.value.lng}],travelMode:google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(s=>{o.setDirections(s)}).catch(s=>{alert("Could not display directions due to: "+s)})},N=l=>{let t=0;const e=l.routes[0];if(e){for(let o=0;o<e.legs.length;o++)t+=e.legs[o].distance.value;t=t/1e3,document.getElementById("total").innerHTML=t+" km"}},R=async()=>{const t=`https://maps.googleapis.com/maps/api/directions/json?origin=${i.value.lat},${i.value.lng}&destination=${u.value.lat},${u.value.lng}&key=${p.system_setting.google_map_api}`;D();try{const e=await fetch(t);if(e.ok){const o=await e.json(),s=E(o.routes[0].overview_polyline.points);m.value=s,d.value={path:s,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}else console.error("Failed to fetch route:",e.statusText)}catch(e){console.error("Error fetching route:",e)}};return B(()=>{i.value={lat:r.value.pickup_latitude,lng:r.value.pickup_longitude},a.value=i.value,u.value={lat:r.value.destination_latitude,lng:r.value.destination_longitude},R()}),{mapRef:v,markerClicked:l=>{h("markerclicked",l)},markers:c,mapCenter:a,mapZoom:f,polylinePath:d,routeCoordinates:m,polylineOptions:_}},props:["system_setting","trip","conf"]},z={class:"w-full overflow-auto"},U={style:{"text-align":"center"}},b=["src"];function j(p,h,v,a,f,c){const d=y("Polyline"),m=y("CustomMarker"),_=y("GoogleMap");return g(),C("div",z,[a.mapCenter?(g(),w(_,{"api-key":v.system_setting.google_map_api,ref:"mapRef",center:a.mapCenter,key:`${a.mapCenter.lat},${a.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:a.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:M(()=>[S(d,{options:a.polylinePath},null,8,["options"]),(g(!0),C(T,null,F(a.markers,(r,k)=>(g(),w(m,{options:{position:r.marker_position},onClick:O=>a.markerClicked(r)},{default:M(()=>[x("div",U,[x("img",{src:r.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,b)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):L("",!0)])}const H=V($,[["render",j]]);export{H as t};
