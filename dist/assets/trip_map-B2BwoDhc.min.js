import{_ as G,r as t,U as L,a as C,o as m,c as O,y as N,O as V,g as S,F as z,f as I,d as g,b as W}from"./index.min.js";import{O as j,L as E,j as F}from"./index.es-BqyRJkQ3.min.js";const J={components:{GoogleMap:j,Polyline:E,CustomMarker:F},emits:["markerclicked"],setup(v,{emit:f}){const r=t(null),o=t(null),w=t(10),i=t([]),c=t([]),u=t([]),_=t({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),e=t(v.trip),k=()=>{if(e.value.status=="started")return{lat:Number(e.value.vehicle.latitude??0),lng:Number(e.value.vehicle.longitude??0)}},y=(n,l,s)=>{let a=JSON.parse(JSON.stringify(n));return a.icon=v.conf.url+"uploads/images/"+s,a.marker_position=l,a.drag=!1,a};(()=>{i.value=[y(e.value,k()??{lat:e.value.pickup_latitude,lng:e.value.pickup_longitude},"car.svg")],i.value[i.value.length]=y(e.value,{lat:e.value.destination_latitude,lng:e.value.destination_longitude},"destination.svg")})();const h=t({lat:0,lng:0}),P=t({lat:0,lng:0}),x=t(null),d=t(null),B=()=>{setTimeout(function(){x.value=new window.google.maps.DirectionsService,d.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:r,panel:document.getElementById("panel")}),d.value.addListener("directions_changed",()=>{d.value.getDirections()}),D(h.value,P.value,x.value,d.value)},1e3)},D=(n,l,s,a)=>{s.route({origin:n,destination:l,waypoints:b(),travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(p=>{console.log(p);const M=R(p);u.value=M,c.value={path:M,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(p=>{alert("Could not display directions due to: "+p)})},R=n=>{const l=n.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(l).map(a=>({lat:a.lat(),lng:a.lng()}))},T=n=>{f("markerclicked",n)},b=()=>{var n=[];for(let l=0;l<i.value.length;l++){const s=i.value[l];n[l]={location:s.marker_position}}return n};return L(()=>{h.value=k()??{lat:e.value.pickup_latitude,lng:e.value.pickup_longitude},o.value=h.value,P.value={lat:e.value.destination_latitude,lng:e.value.destination_longitude},B()}),{map:r,markerClicked:T,markers:i,mapCenter:o,mapZoom:w,polylinePath:c,routeCoordinates:u,polylineOptions:_}},props:["system_setting","trip","conf"]},Z={class:"w-full overflow-auto"},U={style:{"text-align":"center"}},q=["src"],A=g("div",{id:"panel"},null,-1),H=g("div",{id:"total"},null,-1);function K(v,f,r,o,w,i){const c=C("Polyline"),u=C("CustomMarker"),_=C("GoogleMap");return m(),O("div",Z,[o.mapCenter?(m(),N(_,{"api-key":r.system_setting.google_map_api,ref:"map",center:o.mapCenter,key:`${o.mapCenter.lat},${o.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:o.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:V(()=>[S(c,{options:o.polylinePath},null,8,["options"]),(m(!0),O(z,null,I(o.markers,(e,k)=>(m(),N(u,{options:{position:e.marker_position},onClick:y=>o.markerClicked(e)},{default:V(()=>[g("div",U,[g("img",{src:e.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,q)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):W("",!0),A,H])}const $=G(J,[["render",K]]);export{$ as t};
