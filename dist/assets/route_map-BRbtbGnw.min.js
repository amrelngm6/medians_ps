import{_ as F,ag as G,ah as S,af as T,j as n,V as I,r as y,c as x,o as m,x as M,a as L,z as V,f as W,F as E,e as J,b as O}from"./index.min.js";const Z={components:{GoogleMap:T,Polyline:S,CustomMarker:G},emits:["markerclicked"],setup(_,{emit:k}){const c=n(null),o=n(null),h=n(12),s=n([]),u=n([]),d=n([]),v=n({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),a=n(_.route),p=(e,t="lat",i="lng",r)=>{let l=JSON.parse(JSON.stringify(e));return l.icon=_.conf.url+r,l.marker_position={lat:parseFloat(e[t]),lng:parseFloat(e[i])},l.drag=!1,l};(()=>{s.value=[p(a.value.position,"start_latitude","start_longitude","uploads/images/car.svg")];let e=a.value.route_locations;if(e&&e.length)for(let t=0;t<e.length;t++)console.log(e[t]),s.value[t+1]=p(e[t],"start_latitude","start_longitude",e[t].picture??"uploads/images/yellow_pin.gif");s.value[s.value.length]=p(a.value.position,"end_latitude","end_longitude","uploads/images/destination.svg")})();const C=n({lat:0,lng:0}),f=n({lat:0,lng:0}),w=n(null),g=n(null),B=()=>{setTimeout(function(){w.value=new window.google.maps.DirectionsService,g.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:c,panel:document.getElementById("panel")}),g.value.addListener("directions_changed",()=>{g.value.getDirections()}),R(C.value,f.value,w.value,g.value)},1e3)},D=()=>{var e=[];for(let t=0;t<s.value.length;t++){const i=s.value[t];e[t]={location:i.marker_position}}return e},R=(e,t,i,r)=>{i.route({origin:e,destination:t,waypoints:D(),travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(l=>{console.log(l);const P=z(l);d.value=P,u.value={path:P,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(l=>{alert("Could not display directions due to: "+l)})},z=e=>{const t=e.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(t).map(r=>({lat:r.lat(),lng:r.lng()}))};return I(()=>{o.value={lat:a.value.position.start_latitude,lng:a.value.position.start_longitude},C.value=o.value,f.value={lat:a.value.position.end_latitude,lng:a.value.position.end_longitude},B()}),{markerClicked:e=>{k("markerclicked",e)},map:c,markers:s,mapCenter:o,mapZoom:h,polylinePath:u,routeCoordinates:d,polylineOptions:v}},props:["system_setting","route","conf"]},b={class:"w-full overflow-auto"},j={style:{"text-align":"center"}},q=["src"];function A(_,k,c,o,h,s){const u=y("Polyline"),d=y("CustomMarker"),v=y("GoogleMap");return m(),x("div",b,[o.mapCenter?(m(),M(v,{"api-key":c.system_setting.google_map_api,ref:"map",center:o.mapCenter,key:`${o.mapCenter.lat},${o.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:o.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:V(()=>[W(u,{options:o.polylinePath},null,8,["options"]),(m(!0),x(E,null,J(o.markers,(a,p)=>(m(),M(d,{options:{position:a.marker_position},onClick:N=>o.markerClicked(a)},{default:V(()=>[O("div",j,[O("img",{src:a.icon,width:"40",class:"rounded-full",height:"40",style:{"margin-top":"8px"}},null,8,q)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):L("",!0)])}const Q=F(Z,[["render",A]]);export{Q as r};
