import{_ as S,r as n,U as z,a as C,o as _,c as N,y as V,O as B,g as I,F as W,f as E,d as k,b as F}from"./index.min.js";import{O as J,L as Z,j as U}from"./index.es-BqyRJkQ3.min.js";const q={components:{GoogleMap:J,Polyline:Z,CustomMarker:U},emits:["markerclicked"],setup(r,{emit:w}){const u=n(null),a=n(null),P=n(10),i=n([]),d=n([]),p=n([]),y=n({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),t=n(r.trip),g=()=>{if(t.value.status=="started")return{lat:Number(t.value.vehicle.latitude??0),lng:Number(t.value.vehicle.longitude??0)}},M=(e,o,s)=>{var l=e.model&&e.model.picture?e.model.picture:s,c=e.status=="waiting"?e.location.start_latitude:e.location.end_latitude,v=e.status=="waiting"?e.location.start_longitude:e.location.end_longitude;return h(t.value,g()??{lat:c,lng:v},l)},h=(e,o,s="uploads/images/car.svg")=>{let l=JSON.parse(JSON.stringify(e));return l.icon=r.conf.url+s,l.marker_position=o,l.drag=!1,l};(()=>{if(i.value=[h(t.value,g()??{lat:t.value.pickup_latitude,lng:t.value.pickup_longitude},"uploads/images/car.svg")],r.waypoints)for(let o=0;o<r.waypoints.length;o++){var e=r.waypoints[o];i.value[o+1]=M(e)}i.value[i.value.length]=h(t.value,{lat:t.value.destination_latitude,lng:t.value.destination_longitude},"uploads/images/destination.svg")})();const f=n({lat:0,lng:0}),x=n({lat:0,lng:0}),O=n(null),m=n(null),D=()=>{setTimeout(function(){O.value=new window.google.maps.DirectionsService,m.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:u,panel:document.getElementById("panel")}),m.value.addListener("directions_changed",()=>{m.value.getDirections()}),R(f.value,x.value,O.value,m.value)},1e3)},R=(e,o,s,l)=>{s.route({origin:e,destination:o,waypoints:L(),travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(c=>{console.log(c);const v=T(c);p.value=v,d.value={path:v,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(c=>{alert("Could not display directions due to: "+c)})},T=e=>{const o=e.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(o).map(l=>({lat:l.lat(),lng:l.lng()}))},G=e=>{w("markerclicked",e)},L=()=>{var e=[];for(let o=0;o<i.value.length;o++){const s=i.value[o];e[o]={location:s.marker_position}}return e};return z(()=>{f.value=g()??{lat:t.value.pickup_latitude,lng:t.value.pickup_longitude},a.value=f.value,x.value={lat:t.value.destination_latitude,lng:t.value.destination_longitude},D()}),{map:u,markerClicked:G,markers:i,mapCenter:a,mapZoom:P,polylinePath:d,routeCoordinates:p,polylineOptions:y}},props:["system_setting","trip","conf","waypoints","center"]},A={class:"w-full overflow-auto"},H={style:{"text-align":"center"}},K=["src"],Q=k("div",{id:"panel"},null,-1),X=k("div",{id:"total"},null,-1);function Y(r,w,u,a,P,i){const d=C("Polyline"),p=C("CustomMarker"),y=C("GoogleMap");return _(),N("div",A,[a.mapCenter?(_(),V(y,{"api-key":u.system_setting.google_map_api,ref:"map",center:a.mapCenter,key:`${a.mapCenter.lat},${a.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:a.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:B(()=>[I(d,{options:a.polylinePath},null,8,["options"]),(_(!0),N(W,null,E(a.markers,(t,g)=>(_(),V(p,{options:{position:t.marker_position},onClick:M=>a.markerClicked(t)},{default:B(()=>[k("div",H,[k("img",{src:t.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,K)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):F("",!0),Q,X])}const ee=S(q,[["render",Y]]);export{ee as t};
