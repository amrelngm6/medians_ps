import{_ as R,r as e,U as F,a as C,o as v,c as x,y as D,O as P,g as G,F as I,f as S,d as k,b as $,ai as z}from"./index.min.js";import{O as E,L as U,j as b}from"./index.es-BqyRJkQ3.min.js";const J={components:{GoogleMap:E,Polyline:U,CustomMarker:b},emits:["markerclicked"],setup(u,{emit:f}){const d=e(null),t=e(null),w=e(12),r=e([]),p=e([]),m=e([]),y=e({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),a=e(u.trip),h=(o,n="lat",s="lng",i)=>{let l=JSON.parse(JSON.stringify(o));return l.icon=u.conf.url+"uploads/images/"+i,l.marker_position={lat:parseFloat(o[n]),lng:parseFloat(o[s])},l.drag=!1,l};(()=>{r.value=[h(a.value,"pickup_latitude","pickup_longitude","car.svg")],r.value[r.value.length]=h(a.value,"destination_latitude","destination_longitude","destination.svg")})();const c=e({lat:0,lng:0}),g=e({lat:0,lng:0}),M=e(null),_=e(null),B=o=>{console.log(window),setTimeout(function(){M.value=new window.google.maps.DirectionsService,_.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:d,panel:document.getElementById("panel")}),_.value.addListener("directions_changed",()=>{const n=_.value.getDirections();n&&T(n)}),N(c.value,g.value,M.value,_.value)},2e3)},N=(o,n,s,i)=>{s.route({origin:o,destination:n,travelMode:google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(l=>{console.log(l);const O=z(l.routes[0].overview_polyline.points);m.value=O,p.value={path:O,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2},i.setDirections(l)}).catch(l=>{alert("Could not display directions due to: "+l)})},T=o=>{let n=0;const s=o.routes[0];if(s){for(let i=0;i<s.legs.length;i++)n+=s.legs[i].distance.value;n=n/1e3,document.getElementById("total").innerHTML=n+" km"}},L=async()=>(`https://maps.googleapis.com/maps/api/directions/json${c.value.lat}${c.value.lng}${g.value.lat}${g.value.lng}${u.system_setting.google_map_api}`,B());return F(()=>{c.value={lat:a.value.pickup_latitude,lng:a.value.pickup_longitude},t.value=c.value,g.value={lat:a.value.destination_latitude,lng:a.value.destination_longitude},L()}),{map:d,markerClicked:o=>{f("markerclicked",o)},markers:r,mapCenter:t,mapZoom:w,polylinePath:p,routeCoordinates:m,polylineOptions:y}},props:["system_setting","trip","conf"]},W={class:"w-full overflow-auto"},Z={style:{"text-align":"center"}},j=["src"],A=k("div",{id:"panel"},null,-1),H=k("div",{id:"total"},null,-1);function q(u,f,d,t,w,r){const p=C("Polyline"),m=C("CustomMarker"),y=C("GoogleMap");return v(),x("div",W,[t.mapCenter?(v(),D(y,{"api-key":d.system_setting.google_map_api,ref:"map",center:t.mapCenter,key:`${t.mapCenter.lat},${t.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:t.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:P(()=>[G(p,{options:t.polylinePath},null,8,["options"]),(v(!0),x(I,null,S(t.markers,(a,h)=>(v(),D(m,{options:{position:a.marker_position},onClick:V=>t.markerClicked(a)},{default:P(()=>[k("div",Z,[k("img",{src:a.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,j)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):$("",!0),A,H])}const Y=R(J,[["render",q]]);export{Y as t};
