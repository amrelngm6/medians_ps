import{_ as L,r as o,U as S,a as C,o as v,c as N,y as V,O as B,g as z,F as I,f as W,d as _,b as j}from"./index.min.js";import{O as E,L as F,j as J}from"./index.es-BqyRJkQ3.min.js";const Z={components:{GoogleMap:E,Polyline:F,CustomMarker:J},emits:["markerclicked"],setup(r,{emit:w}){const u=o(null),n=o(null),P=o(10),a=o([]),d=o([]),p=o([]),y=o({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),e=o(r.trip),k=()=>{if(e.value.status=="started")return{lat:Number(e.value.vehicle.latitude??0),lng:Number(e.value.vehicle.longitude??0)}},h=(t,l,c)=>{let s=JSON.parse(JSON.stringify(t));return s.icon=r.conf.url+"uploads/images/"+c,s.marker_position=l,s.drag=!1,s};(()=>{if(a.value=[h(e.value,k()??{lat:e.value.pickup_latitude,lng:e.value.pickup_longitude},"car.svg")],r.waypoints)for(let t=0;t<r.waypoints.length;t++)a.value[i+1]=r.waypoints[t];a.value[a.value.length]=h(e.value,{lat:e.value.destination_latitude,lng:e.value.destination_longitude},"destination.svg")})();const f=o({lat:0,lng:0}),x=o({lat:0,lng:0}),M=o(null),m=o(null),D=()=>{setTimeout(function(){M.value=new window.google.maps.DirectionsService,m.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:u,panel:document.getElementById("panel")}),m.value.addListener("directions_changed",()=>{m.value.getDirections()}),R(f.value,x.value,M.value,m.value)},1e3)},R=(t,l,c,s)=>{c.route({origin:t,destination:l,waypoints:G(),travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(g=>{console.log(g);const O=T(g);p.value=O,d.value={path:O,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(g=>{alert("Could not display directions due to: "+g)})},T=t=>{const l=t.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(l).map(s=>({lat:s.lat(),lng:s.lng()}))},b=t=>{w("markerclicked",t)},G=()=>{var t=[];for(let l=0;l<a.value.length;l++){const c=a.value[l];t[l]={location:c.marker_position}}return t};return S(()=>{f.value=k()??{lat:e.value.pickup_latitude,lng:e.value.pickup_longitude},n.value=f.value,x.value={lat:e.value.destination_latitude,lng:e.value.destination_longitude},D()}),{map:u,markerClicked:b,markers:a,mapCenter:n,mapZoom:P,polylinePath:d,routeCoordinates:p,polylineOptions:y}},props:["system_setting","trip","conf","waypoints","center"]},U={class:"w-full overflow-auto"},q={style:{"text-align":"center"}},A=["src"],H=_("div",{id:"panel"},null,-1),K=_("div",{id:"total"},null,-1);function Q(r,w,u,n,P,a){const d=C("Polyline"),p=C("CustomMarker"),y=C("GoogleMap");return v(),N("div",U,[n.mapCenter?(v(),V(y,{"api-key":u.system_setting.google_map_api,ref:"map",center:n.mapCenter,key:`${n.mapCenter.lat},${n.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:n.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:B(()=>[z(d,{options:n.polylinePath},null,8,["options"]),(v(!0),N(I,null,W(n.markers,(e,k)=>(v(),V(p,{options:{position:e.marker_position},onClick:h=>n.markerClicked(e)},{default:B(()=>[_("div",q,[_("img",{src:e.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,A)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):j("",!0),H,K])}const ee=L(Z,[["render",Q]]);export{ee as t};
