import{_ as S,r as o,U as T,a as f,o as v,c as x,y as O,O as D,g as F,F as L,f as E,d as _,b as G,ai as I}from"./index.min.js";import{O as W,L as $,j as z}from"./index.es-BqyRJkQ3.min.js";const U={components:{GoogleMap:W,Polyline:$,CustomMarker:z},emits:["markerclicked"],setup(d,{emit:C}){const k=o(null),n=o(null),w=o(12),c=o([]),p=o([]),m=o([]),h=o({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),s=o(d.trip),y=(a,e="lat",t="lng",i)=>{let l=JSON.parse(JSON.stringify(a));return l.icon=d.conf.url+"uploads/images/"+i,l.marker_position={lat:parseFloat(a[e]),lng:parseFloat(a[t])},l.drag=!1,l};(()=>{c.value=[y(s.value,"pickup_latitude","pickup_longitude","car.svg")],c.value[c.value.length]=y(s.value,"destination_latitude","destination_longitude","destination.svg")})();const r=o({lat:0,lng:0}),u=o({lat:0,lng:0}),M=o(null),g=o(null),N=a=>{M.value=new google.maps.DirectionsService,g.value=new google.maps.DirectionsRenderer({draggable:!0,map,panel:document.getElementById("panel")}),g.value.addListener("directions_changed",()=>{const e=g.value.getDirections();e&&V(e)}),R("Perth, WA","Sydney, NSW",M.value,g.value)},R=(a,e,t,i)=>{t.route({origin:a,destination:e,waypoints:[{location:r.value.lat+","+r.value.lng},{location:u.value.lat+","+u.value.lng}],travelMode:google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(l=>{i.setDirections(l)}).catch(l=>{alert("Could not display directions due to: "+l)})},V=a=>{let e=0;const t=a.routes[0];if(t){for(let i=0;i<t.legs.length;i++)e+=t.legs[i].distance.value;e=e/1e3,document.getElementById("total").innerHTML=e+" km"}},B=async()=>{const e=`https://maps.googleapis.com/maps/api/directions/json?origin=${r.value.lat},${r.value.lng}&destination=${u.value.lat},${u.value.lng}&key=${d.system_setting.google_map_api}`;N();try{const t=await fetch(e);if(t.ok){const i=await t.json(),l=I(i.routes[0].overview_polyline.points);m.value=l,p.value={path:l,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}else console.error("Failed to fetch route:",t.statusText)}catch(t){console.error("Error fetching route:",t)}};return T(()=>{r.value={lat:s.value.pickup_latitude,lng:s.value.pickup_longitude},n.value=r.value,u.value={lat:s.value.destination_latitude,lng:s.value.destination_longitude},B()}),{mapRef:k,markerClicked:a=>{C("markerclicked",a)},markers:c,mapCenter:n,mapZoom:w,polylinePath:p,routeCoordinates:m,polylineOptions:h}},props:["system_setting","trip","conf"]},b={class:"w-full overflow-auto"},j={style:{"text-align":"center"}},A=["src"],J=_("div",{id:"panel"},null,-1),Z=_("div",{id:"total"},null,-1);function H(d,C,k,n,w,c){const p=f("Polyline"),m=f("CustomMarker"),h=f("GoogleMap");return v(),x("div",b,[n.mapCenter?(v(),O(h,{"api-key":k.system_setting.google_map_api,ref:"mapRef",center:n.mapCenter,key:`${n.mapCenter.lat},${n.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:n.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:D(()=>[F(p,{options:n.polylinePath},null,8,["options"]),(v(!0),x(L,null,E(n.markers,(s,y)=>(v(),O(m,{options:{position:s.marker_position},onClick:P=>n.markerClicked(s)},{default:D(()=>[_("div",j,[_("img",{src:s.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,A)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):G("",!0),J,Z])}const X=S(U,[["render",H]]);export{X as t};
