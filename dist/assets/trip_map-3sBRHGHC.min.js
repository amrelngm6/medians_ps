import{_ as S,r as n,U as z,a as w,o as y,c as N,y as V,O as B,g as I,F as W,f as E,d as h,b as F}from"./index.min.js";import{O as J,L as Z,j as U}from"./index.es-BqyRJkQ3.min.js";const q={components:{GoogleMap:J,Polyline:Z,CustomMarker:U},emits:["markerclicked"],setup(r,{emit:P}){const u=n(null),l=n(null),M=n(10),s=n([]),d=n([]),p=n([]),k=n({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),o=n(r.trip),g=()=>{if(o.value.status=="started")return{lat:Number(o.value.vehicle.latitude??0),lng:Number(o.value.vehicle.longitude??0)}},x=(e,t,i)=>{var a=e.model&&e.model.picture?e.model.picture:i,c=e.status=="waiting"?e.location.start_latitude:e.location.end_latitude,_=e.status=="waiting"?e.location.start_longitude:e.location.end_longitude;return f(o.value,g()??{lat:c,lng:_},a)},f=(e,t,i="uploads/images/car.svg")=>{let a=JSON.parse(JSON.stringify(e));return a.icon=r.conf.url+i,a.marker_position=t,a.drag=!1,a};(()=>{if(s.value=[f(o.value,g()??m.value,"uploads/images/car.svg")],r.waypoints)for(let t=0;t<r.waypoints.length;t++){var e=r.waypoints[t];s.value[t+1]=x(e),console.log(s.value[t+1])}s.value[s.value.length]=f(o.value,C.value,"uploads/images/destination.svg")})();const m=n({lat:0,lng:0}),C=n({lat:0,lng:0}),O=n(null),v=n(null),D=()=>{setTimeout(function(){O.value=new window.google.maps.DirectionsService,v.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:u,panel:document.getElementById("panel")}),v.value.addListener("directions_changed",()=>{v.value.getDirections()}),R(m.value,C.value,O.value,v.value)},1e3)},R=(e,t,i,a)=>{console.log(e),console.log(t),i.route({origin:e,destination:t,waypoints:L(),travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(c=>{console.log(c);const _=T(c);p.value=_,d.value={path:_,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(c=>{alert("Could not display directions due to: "+c)})},T=e=>{const t=e.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(t).map(a=>({lat:a.lat(),lng:a.lng()}))},G=e=>{P("markerclicked",e)},L=()=>{var e=[];for(let t=0;t<s.value.length;t++){const i=s.value[t];e[t]={location:i.marker_position}}return e};return z(()=>{m.value=g()??{lat:o.value.route.start_latitude,lng:o.value.route.start_longitude},l.value=m.value,C.value={lat:o.value.route.end_latitude,lng:o.value.route.end_longitude},D()}),{map:u,markerClicked:G,markers:s,mapCenter:l,mapZoom:M,polylinePath:d,routeCoordinates:p,polylineOptions:k}},props:["system_setting","trip","conf","waypoints","center"]},A={class:"w-full overflow-auto"},H={style:{"text-align":"center"}},K=["src"],Q=h("div",{id:"panel"},null,-1),X=h("div",{id:"total"},null,-1);function Y(r,P,u,l,M,s){const d=w("Polyline"),p=w("CustomMarker"),k=w("GoogleMap");return y(),N("div",A,[l.mapCenter?(y(),V(k,{"api-key":u.system_setting.google_map_api,ref:"map",center:l.mapCenter,key:`${l.mapCenter.lat},${l.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:l.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:B(()=>[I(d,{options:l.polylinePath},null,8,["options"]),(y(!0),N(W,null,E(l.markers,(o,g)=>(y(),V(p,{options:{position:o.marker_position},onClick:x=>l.markerClicked(o)},{default:B(()=>[h("div",H,[h("img",{src:o.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,K)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):F("",!0),Q,X])}const ee=S(q,[["render",Y]]);export{ee as t};
