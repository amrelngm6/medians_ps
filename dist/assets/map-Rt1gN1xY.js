import{O as S,x as B,L as I,$ as j,j as V}from"./index.es-zOxQbM5g.js";import{_ as J,q as a,r as h,o as l,c as y,j as _,u as C,F as x,a as b,i as P,d as z}from"./index-iLtlYwCe.js";const T={components:{GoogleMap:S,Marker:B,Polyline:I,InfoWindow:j,CustomMarker:V},name:"Map",emits:["click-marker","update-marker"],setup(r,{emit:g}){console.log(r.waypoints);const c=a(null),t=a(null),i=a(null),w=a("Driving"),u=a(14);a([]);const m=a([]),k=a({}),s=a({}),n=a({}),p=(o,e)=>{i.value=!!r.dragggable,f(o,e)},f=async(o,e)=>{n.value=e,g("click-marker",r.waypoints[e],e,JSON.parse(JSON.stringify(o)))},L=async o=>{let e=r.waypoints[n.value];e.latitude=o.latLng.lat(),e.longitude=o.latLng.lng(),e.address=await F(e.latitude,e.longitude),r.waypoints[n.value].destination={lat:e.latitude,lng:e.longitude},i.value=null,g("update-marker",e)},O=async(o,e)=>{const d=new google.maps.Geocoder,G={lat:parseFloat(o),lng:parseFloat(e)};return new Promise((N,M)=>{d.geocode({location:G},(v,D)=>{D==="OK"?v[0]?N(v[0]):M("No results found"):M(`Geocoder failed due to: ${D}`)})})},F=async(o,e)=>{try{return(await O(o,e)).formatted_address}catch(d){console.error(d)}};return{checkMarker:f,onMarkerDragStart:o=>{n.value=o},enableDrag:p,updateMarker:L,reload:c,render:t,showDrag:i,travelMode:w,origin:{lat:0,lng:0},destination:{lat:0,lng:0},zoom:u,markers:r.waypoints,polylineCoordinates:m,activeMarkerIndex:n,directionPoints:k,activeDestination:s}},props:["path","lang","setting","conf","auth","waypoints","showroute","dragggable","center"]},q={class:"w-full overflow-auto",style:{height:"85vh","z-index":"9999"}},E={style:{"text-align":"center"}},K=["src"];function W(r,g,c,t,i,w){const u=h("CustomMarker"),m=h("Marker"),k=h("GoogleMap");return l(),y("div",q,[(l(),_(k,{"api-key":c.setting.google_map_api,ref:"gmap",center:c.center,key:t.reload,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:t.zoom,style:{width:"100%",height:"calc(100vh -  100px)"}},{default:C(()=>[t.showDrag?z("",!0):(l(!0),y(x,{key:0},P(t.markers,(s,n)=>(l(),_(u,{options:{draggable:!0,position:s.destination},key:t.showDrag,draggable:!0,onClick:p=>t.enableDrag(s,n)},{default:C(()=>[b("div",E,[b("img",{src:s.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,K)])]),_:2},1032,["options","onClick"]))),128)),t.showDrag?(l(!0),y(x,{key:1},P(t.markers,(s,n)=>(l(),_(m,{options:{position:s.destination,draggable:!0},key:t.showDrag,onDragstart:p=>t.onMarkerDragStart(n),onDragend:t.updateMarker},null,8,["options","onDragstart","onDragend"]))),128)):z("",!0)]),_:1},8,["api-key","center","zoom"]))])}const R=J(T,[["render",W]]);export{R as default};
