import{_ as b,r as t,W as z,a as C,o as m,c as N,y as O,z as V,g as G,F as L,f as S,d as g,b as I}from"./index.min.js";import{O as W,L as j,j as E}from"./index.es-jn268Cag.min.js";const F={components:{GoogleMap:W,Polyline:j,CustomMarker:E},emits:["markerclicked"],setup(v,{emit:f}){const s=t(null),o=t(null),w=t(10),a=t([]),r=t([]),c=t([]),_=t({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),e=t(v.trip),k=()=>{if(e.value.status=="started")return{lat:Number(e.value.vehicle.latitude??0),lng:Number(e.value.vehicle.longitude??0)}},y=(l,i,d)=>{let n=JSON.parse(JSON.stringify(l));return n.icon=v.conf.url+"uploads/images/"+d,n.marker_position=i,n.drag=!1,n};(()=>{a.value=[y(e.value,k()??{lat:e.value.pickup_latitude,lng:e.value.pickup_longitude},"car.svg")],a.value[a.value.length]=y(e.value,{lat:e.value.destination_latitude,lng:e.value.destination_longitude},"destination.svg")})();const h=t({lat:0,lng:0}),P=t({lat:0,lng:0}),x=t(null),u=t(null),B=()=>{setTimeout(function(){x.value=new window.google.maps.DirectionsService,u.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:s,panel:document.getElementById("panel")}),u.value.addListener("directions_changed",()=>{u.value.getDirections()}),D(h.value,P.value,x.value,u.value)},1e3)},D=(l,i,d,n)=>{d.route({origin:l,destination:i,travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(p=>{console.log(p);const M=R(p);c.value=M,r.value={path:M,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(p=>{alert("Could not display directions due to: "+p)})},R=l=>{const i=l.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(i).map(n=>({lat:n.lat(),lng:n.lng()}))},T=l=>{f("markerclicked",l)};return z(()=>{h.value=k()??{lat:e.value.pickup_latitude,lng:e.value.pickup_longitude},o.value=h.value,P.value={lat:e.value.destination_latitude,lng:e.value.destination_longitude},B()}),{map:s,markerClicked:T,markers:a,mapCenter:o,mapZoom:w,polylinePath:r,routeCoordinates:c,polylineOptions:_}},props:["system_setting","trip","conf"]},J={class:"w-full overflow-auto"},Z={style:{"text-align":"center"}},q=["src"],A=g("div",{id:"panel"},null,-1),H=g("div",{id:"total"},null,-1);function K(v,f,s,o,w,a){const r=C("Polyline"),c=C("CustomMarker"),_=C("GoogleMap");return m(),N("div",J,[o.mapCenter?(m(),O(_,{"api-key":s.system_setting.google_map_api,ref:"map",center:o.mapCenter,key:`${o.mapCenter.lat},${o.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:o.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:V(()=>[G(r,{options:o.polylinePath},null,8,["options"]),(m(!0),N(L,null,S(o.markers,(e,k)=>(m(),O(c,{options:{position:e.marker_position},onClick:y=>o.markerClicked(e)},{default:V(()=>[g("div",Z,[g("img",{src:e.icon,width:"40",class:"rounded-full",height:"40",style:{"margin-top":"8px"}},null,8,q)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):I("",!0),A,H])}const Y=b(F,[["render",K]]);export{Y as t};
