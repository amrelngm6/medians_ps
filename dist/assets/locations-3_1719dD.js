import{d as f}from"./data-table-actions-tag9ZN1N.js";import{_ as w,r as h,o as i,c as r,a as n,j as u,d as c,l as k,t as a,w as v,v as b,F as y,i as C,n as L,b as T,m as j}from"./index-BUzEqB0A.js";const S={components:{dataTableActions:f},name:"Locations",data(){return{url:this.conf.url+this.path+"?load=json",content:{title:"",items:[],columns:[]},locations:[],activeItem:{},showAddSide:!1,showEditSide:!1,showLoader:!0,collapsed:!1,searchText:""}},computed:{bindings(){return this.content.columns.push({key:this.__("actions"),component:f,sortable:!1}),{columns:this.content.columns,fillable:this.content.fillable,data:this.content.items}}},props:["path","lang","setting","conf","auth"],mounted(){this.load()},methods:{searchTextChanged(){this.showList=!1;for(let e=0;e<this.content.items.length;e++)this.content.items[e].active=this.searchText.trim()?this.checkSimilar(this.content.items[e]):1;this.showList=!0},checkSimilar(e){let s=!!e.student_name.toLowerCase().includes(this.searchText.toLowerCase());return s||!!e.location_name.toLowerCase().includes(this.searchText.toLowerCase())},updatedLocation(e,s,d){console.log(d),e.latitude=e.destination.lat,e.longitude=e.destination.lng,this.handleAction("edit",e),console.log(e)},setLocationsMarkers(e){this.locations=[this.handleObject(e)],this.center=this.locations[0].destination},handleAction(e,s){switch(e){case"view":break;case"edit":this.showEditSide=!0,this.showAddSide=!1,this.activeItem=s;break;case"delete":this.$parent.deleteByKey("pickup_id",s,"PickupLocation.delete");break}},load(){this.showLoader=!0,this.$parent.handleGetRequest(this.url).then(e=>{this.setValues(e),this.showLoader=!1,this.searchTextChanged()})},setValues(e){this.content=JSON.parse(JSON.stringify(e));for(let s=0;s<this.content.items.length;s++)this.locations[s]=this.handleObject(this.content.items[s]);return this.center=this.locations[0]?this.locations[0].destination:{lat:30,lng:31},this},handleObject(e){return e.icon=this.conf.url+"uploads/images/blue_pin.gif",e.origin=e.destination={lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)},e.drag=!0,e},__(e){return this.$root.$children[0].__(e)}}},A={class:"w-full flex overflow-auto",style:{height:"85vh","z-index":"9999"}},I={class:"w-full"},M={key:0,class:"relative flex-1 overflow-x-hidden overflow-y-auto w-full"},P={class:"self-stretch py-4 flex-col justify-center items-start flex"},V=["textContent"],B=["textContent"],E={key:0,class:"w-full self-stretch pt-2 flex-col justify-center items-start flex"},N=["placeholder"],O={key:0,class:"grow shrink basis-0 gap-4 justify-start items-center flex"},z={class:"justify-start items-center flex"},F=["src"],U=["onClick"],D=["textContent"],J=["textContent"],K={class:"justify-center items-center flex"},q=["onClick"],G=n("div",{class:"text-center text-xs text-white uppercase tracking-tight"},[n("i",{class:"fa fa-edit"})],-1),R=[G],H={class:"flex self-stretch grow shrink basis-0 justify-between items-center inline-flex"},Q=["textContent"],W=["textContent"],X={class:"px-4 mb-6 py-4 rounded-lg shadow-lg bg-white dark:bg-gray-700 flex w-full"},Y=["textContent"],Z=n("hr",{class:"mt-2"},null,-1),$={class:"w-full flex gap gap-6"};function ee(e,s,d,te,t,l){const m=h("maps"),p=h("data-table"),x=h("side-form-create"),_=h("side-form-update");return i(),r("div",A,[n("div",I,[t.content&&!t.showLoader?(i(),r("main",M,[t.locations.length?(i(),u(m,{onUpdateMarker:l.updatedLocation,onClickMarker:l.updatedLocation,key:e.center,center:e.center,waypoints:t.locations},null,8,["onUpdateMarker","onClickMarker","center","waypoints"])):c("",!0),t.locations.length?(i(),r("div",{key:1,style:k(t.collapsed?"max-height:240px":"max-height:calc(100vh - 140px)"),class:"mx-16 h-full absolute top-4 rounded-lg p-4 w-96 bg-white rounded-xl flex-col justify-start items-start inline-flex"},[n("div",P,[n("div",{class:"text-black text-lg font-semibold",textContent:a(l.__("Pickup locations"))},null,8,V),n("div",{class:"py-2 self-stretch text-zinc-600 text-base tracking-wide",textContent:a(l.__("Pickup locations description"))},null,8,B)]),t.collapsed?c("",!0):(i(),r("div",E,[v(n("input",{class:"w-full bg-gray-100 rounded-lg px-4 py-2",placeholder:l.__("find by name and address"),"onUpdate:modelValue":s[0]||(s[0]=o=>t.searchText=o),onChange:s[1]||(s[1]=(...o)=>l.searchTextChanged&&l.searchTextChanged(...o)),onInput:s[2]||(s[2]=(...o)=>l.searchTextChanged&&l.searchTextChanged(...o)),onKeydown:s[3]||(s[3]=(...o)=>l.searchTextChanged&&l.searchTextChanged(...o))},null,40,N),[[b,t.searchText]])])),t.collapsed?c("",!0):(i(),r("div",{key:t.collapsed,class:"max-h-[400px] overflow-auto my-4 w-full self-stretch py-4"},[e.showList&&e.location.active?(i(!0),r(y,{key:0},C(t.content.items,o=>(i(),r("div",{key:o.active,class:"pt-2 w-full self-stretch justify-start items-center inline-flex"},[o.active?(i(),r("div",O,[n("div",z,[n("img",{class:"w-10 h-10 rounded-full shadow-inner border-2 border-black",src:o.student&&o.student.picture?o.student.picture:"https://via.placeholder.com/60x6"},null,8,F)]),n("div",{onClick:g=>l.setLocationsMarkers(o),class:"grow shrink basis-0 flex-col justify-center items-start gap-[3px] inline-flex cursor-pointer"},[n("div",{class:"text-black font-semibold text-base",textContent:a(o.student_name)},null,8,D),n("div",{class:"self-stretch text-slate-500 text-sm font-normal",textContent:a(o.location_name+" - "+o.address)},null,8,J)],8,U)])):c("",!0),n("div",K,[n("div",{class:"px-3 py-2 bg-purple-800 rounded justify-center items-center flex mr-2 cursor-pointer",onClick:g=>l.handleAction("edit",o)},R,8,q)])]))),128)):c("",!0)])),n("div",H,[n("div",{class:"menu-dark rounded-lg text-white text-xs font-medium px-4 py-3 uppercase cursor-pointer",onClick:s[4]||(s[4]=o=>{t.showLoader=!0,t.showAddSide=!0,t.activeItem={},t.showLoader=!1}),textContent:a(l.__("add new"))},null,8,Q),n("div",{onClick:s[5]||(s[5]=o=>t.collapsed=!t.collapsed),class:"cursor-pointer p-2 block text-center"},[n("i",{class:L(["fa",t.collapsed?"fa-circle-down":"fa-circle-up"])},null,2),n("p",{class:"font-semibold",textContent:a(t.collapsed?l.__("Expand"):l.__("Collapse"))},null,8,W)])])],4)):c("",!0),n("div",X,[n("h1",{class:"font-bold text-lg w-full",textContent:a(t.content.title)},null,8,Y),n("a",{href:"javascript:;",class:"uppercase p-2 mx-2 text-center text-white w-32 rounded-lg menu-dark hover:bg-purple-800",onClick:s[6]||(s[6]=o=>{t.showLoader=!0,t.showAddSide=!0,t.activeItem={},t.showLoader=!1})},a(l.__("add_new")),1)]),Z,n("div",$,[T(p,j({ref:"locations",onActionTriggered:l.handleAction},l.bindings),null,16,["onActionTriggered"]),t.showAddSide&&t.content&&t.content.fillable?(i(),u(x,{key:0,conf:d.conf,model:"PickupLocation.create",columns:t.content.fillable,class:"col-md-3"},null,8,["conf","columns"])):c("",!0),t.showEditSide&&!t.showAddSide?(i(),u(_,{key:1,conf:d.conf,model:"PickupLocation.update",item:t.activeItem,model_id:t.activeItem.pickup_id,index:"pickup_id",columns:t.content.fillable,class:"col-md-3"},null,8,["conf","item","model_id","columns"])):c("",!0)])])):c("",!0)])])}const oe=w(S,[["render",ee]]);export{oe as default};
