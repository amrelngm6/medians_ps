import{_ as T,r as o,U as F,a as f,o as _,c as x,y as O,O as D,g as L,F as R,f as E,d as k,b as G,ai as I}from"./index.min.js";import{O as W,L as $,j as z}from"./index.es-BqyRJkQ3.min.js";const U={components:{GoogleMap:W,Polyline:$,CustomMarker:z},emits:["markerclicked"],setup(p,{emit:C}){const c=o(null),n=o(null),w=o(12),u=o([]),m=o([]),g=o([]),h=o({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),s=o(p.trip),y=(a,e="lat",t="lng",r)=>{let l=JSON.parse(JSON.stringify(a));return l.icon=p.conf.url+"uploads/images/"+r,l.marker_position={lat:parseFloat(a[e]),lng:parseFloat(a[t])},l.drag=!1,l};(()=>{u.value=[y(s.value,"pickup_latitude","pickup_longitude","car.svg")],u.value[u.value.length]=y(s.value,"destination_latitude","destination_longitude","destination.svg")})();const i=o({lat:0,lng:0}),d=o({lat:0,lng:0}),M=o(null),v=o(null),N=a=>{c.value&&(M.value=new google.maps.DirectionsService,v.value=new google.maps.DirectionsRenderer({draggable:!0,map:c,panel:document.getElementById("panel")}),v.value.addListener("directions_changed",()=>{const e=v.value.getDirections();e&&B(e)}),V("Perth, WA","Sydney, NSW",M.value,v.value))},V=(a,e,t,r)=>{t.route({origin:a,destination:e,waypoints:[{location:i.value.lat+","+i.value.lng},{location:d.value.lat+","+d.value.lng}],travelMode:google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(l=>{r.setDirections(l)}).catch(l=>{alert("Could not display directions due to: "+l)})},B=a=>{let e=0;const t=a.routes[0];if(t){for(let r=0;r<t.legs.length;r++)e+=t.legs[r].distance.value;e=e/1e3,document.getElementById("total").innerHTML=e+" km"}},S=async()=>{const e=`https://maps.googleapis.com/maps/api/directions/json?origin=${i.value.lat},${i.value.lng}&destination=${d.value.lat},${d.value.lng}&key=${p.system_setting.google_map_api}`;N();try{const t=await fetch(e);if(t.ok){const r=await t.json(),l=I(r.routes[0].overview_polyline.points);g.value=l,m.value={path:l,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}else console.error("Failed to fetch route:",t.statusText)}catch(t){console.error("Error fetching route:",t)}};return F(()=>{i.value={lat:s.value.pickup_latitude,lng:s.value.pickup_longitude},n.value=i.value,d.value={lat:s.value.destination_latitude,lng:s.value.destination_longitude},S()}),{map:c,markerClicked:a=>{C("markerclicked",a)},markers:u,mapCenter:n,mapZoom:w,polylinePath:m,routeCoordinates:g,polylineOptions:h}},props:["system_setting","trip","conf"]},b={class:"w-full overflow-auto"},j={style:{"text-align":"center"}},A=["src"],J=k("div",{id:"panel"},null,-1),Z=k("div",{id:"total"},null,-1);function H(p,C,c,n,w,u){const m=f("Polyline"),g=f("CustomMarker"),h=f("GoogleMap");return _(),x("div",b,[n.mapCenter?(_(),O(h,{"api-key":c.system_setting.google_map_api,ref:"map",center:n.mapCenter,key:`${n.mapCenter.lat},${n.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:n.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:D(()=>[L(m,{options:n.polylinePath},null,8,["options"]),(_(!0),x(R,null,E(n.markers,(s,y)=>(_(),O(g,{options:{position:s.marker_position},onClick:P=>n.markerClicked(s)},{default:D(()=>[k("div",j,[k("img",{src:s.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,A)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):G("",!0),J,Z])}const X=T(U,[["render",H]]);export{X as t};
