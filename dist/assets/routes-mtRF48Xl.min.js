import{_ as ee,D as te,e as ae,y as le,z as oe,f as s,t as se,r as p,o as i,c as d,g as P,h as r,i as c,j as k,A,F as ne,B as j,k as ie,a as D,d as E,b as R,m as ce,s as J,C as re,n as de,E as ue,G as _e,p as me}from"./index.min.js";import{e as ve}from"./editable_map_location-uq_QjuLd.min.js";import he from"./routeWizard-kLuhvokS.min.js";import"./index.es-sRIzCSW1.min.js";const ge=E(()=>R(()=>import("./map-GtxasIM0.min.js"),__vite__mapDeps([0,1,2,3]))),fe=E(()=>R(()=>import("./side-form-create-CbF3czHg.min.js"),__vite__mapDeps([4,2,3,5,6]))),pe=E(()=>R(()=>import("./side-form-update-_mffNT-n.min.js"),__vite__mapDeps([7,2,3,5,6,8,9,1]))),be=E(()=>R(()=>import("./form_field-J_TGEATC.min.js"),__vite__mapDeps([8,2,3,5,6,9,1]))),we={components:{datatabble:te,SideFormCreate:fe,SideFormUpdate:pe,maps:ge,delete_icon:ae,car_icon:le,route_icon:oe,form_field:be,editable_map_location:ve,route_wizard:he},name:"Routes",setup(v){const f=v.conf.url+v.path+"?load=json",h=s(!1),t=s(!1),O=s(null),a=s({}),z=s("Info"),u=s({}),y=s({});s([]),s(!0);const b=s(""),F=s(null),I=s(!1),x=s(!1),o=s(["Info","Time","Start location","End location","Driver"]),_=s([]),w=s(!1),L=s(""),G=()=>{h.value=!1,t.value=!1};(()=>{ce(f).then(e=>{u.value=JSON.parse(JSON.stringify(e)),W()})})();const T=async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{a.value.start_latitude=e.coords.latitude,a.value.start_longitude=e.coords.longitude,a.value.end_latitude=e.coords.latitude,a.value.end_longitude=e.coords.longitude},e=>{a.value.start_latitude=30.06,a.value.start_longitude=31.21,a.value.end_latitude=30.06,a.value.end_longitude=31.21,J(e.message)}):(J("location error"),F.value="Geolocation is not supported by this browser.")},U=()=>{a.value={},x.value=!0,T()},q=async()=>{let e=L.value.length>3?await re(v.system_setting.google_map_api,L.value,v.business_setting.country):"";_.value=e.predictions},K=()=>{var e=new URLSearchParams;let l=JSON.parse(JSON.stringify(a.value)),n=Object.keys(l),g;for(let m=0;m<n.length;m++)g=n[m],e.append("params["+g+"]",l[g]);e.append("type","Route.create"),de(e,"/api/create").then(m=>{ue(m)})},W=()=>{for(let e=0;e<u.value.items.length;e++)u.value.items[e].active=b.value.trim()?M(u.value.items[e]):1},M=e=>{let l=!!e.route_name.toLowerCase().includes(b.value.toLowerCase());return l||!!e.description.toLowerCase().includes(b.toLowerCase())},H=(e,l)=>{a.value=e;for(let n=0;n<u.value.items.length;n++)u.value.items[n].selected=!1;u.value.items[l].selected=!0,N.value=V(e)},Q=async e=>{a.value.start_latitude=e.lat(),a.value.start_longitude=e.lng(),a.value.start_address=await _e(e.lat(),e.lng())},X=e=>{a.value.end_latitude=e.lat(),a.value.end_longitude=e.lng()},Y=(e,l,n)=>{},V=e=>{let l,n=[],g=v.conf.url+"uploads/images/blue_pin.gif",m=v.conf.url+"uploads/images/car.svg",C=v.conf.url+"uploads/images/destination.svg";for(let S=0;S<e.pickup_locations.length;S++)l=e.pickup_locations[S],n[S]={title:l.student_name,icon:g,origin:{lat:parseFloat(l.latitude),lng:parseFloat(l.longitude)},destination:{lat:parseFloat(l.latitude),lng:parseFloat(l.longitude)}};let B={icon:m,origin:{lat:parseFloat(e.vehicle.last_latitude),lng:parseFloat(e.vehicle.last_longitude)},destination:{lat:parseFloat(e.vehicle.last_latitude),lng:parseFloat(e.vehicle.last_longitude)}};n[n.length]=B;let $={drag:!0,icon:C,origin:B.origin,destination:{lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)}};return n[n.length]=$,y.value=n[0].destination,n},Z=(e,l)=>{switch(e){case"view":break;case"edit":a.value=l,x.value=!0;break;case"delete":me("route_id",l,"Route.delete");break;case"close":t.value=!1,h.value=!1,O.value=!1,a.value={};break}},N=s([]);return{setPlaceMarker:async e=>{a.value.start_address=e.description;const l=new google.maps.places.PlacesService(document.createElement("div"));let n=e.place_id;l.getDetails({placeId:n},(g,m)=>{if(m===google.maps.places.PlacesServiceStatus.OK&&g){const C=g.geometry.location;a.value.start_longitude=C.lng(),a.value.start_latitude=C.lat(),_.value=[],w.value=!1}else console.error("Failed to fetch place details")})},showPlaceSearch:w,startPlaceChanged:q,start_placeSearch:L,places:_,showAddSide:h,waypoints:N,showEditSide:t,url:f,content:u,fillable:o,center:y,activeItem:a,activeTab:z,translate:se,setLocationsPickups:V,clickMarker:Y,updateStartMarker:Q,updateEndMarker:X,setLocationsMarkers:H,checkSimilar:M,searchTextChanged:W,searchText:b,getUserLocation:T,showWizard:x,collapsed:I,closeSide:G,saveRoute:K,addRouteWizard:U,handleAction:Z}},props:["path","lang","system_setting","business_setting","setting","conf","auth"]},ke={class:"w-full flex overflow-auto"},xe={key:0,class:"w-full relative"},ye={key:1,class:""},Ce={class:"card"},Se={class:"card-body"},Pe={class:"card-px text-center pt-15 pb-15"},Ae=["textContent"],Ee=["textContent"],Re=["textContent"],ze={class:"text-center pb-15 px-5"},Fe=["src"],Ie={key:2,class:"flex-1 overflow-x-hidden overflow-y-auto w-full relative"},Le={class:"px-4 mb-6 py-4 rounded-lg shadow-md bg-white dark:bg-gray-700 flex w-full"},De=["textContent"],Oe=c("hr",{class:"mt-2"},null,-1),Te={class:"w-full"},We=["src"],Me={class:"w-full h-8 relative flex"},Ve=["src"],Ne=["textContent"],Be=["onClick"],je=["onClick"];function Je(v,f,h,t,O,a){const z=p("route_wizard"),u=p("route_icon"),y=p("vue-feather"),b=p("delete_icon"),F=p("datatabble"),I=p("side-form-create"),x=p("side-form-update");return i(),d("div",ke,[t.content?(i(),d("div",xe,[t.showWizard?(i(),P(z,{key:t.showWizard,drivers:t.content.drivers,vehicles:t.content.vehicles,system_setting:h.system_setting,item:t.activeItem,business_setting:h.business_setting},null,8,["drivers","vehicles","system_setting","item","business_setting"])):r("",!0),!t.showWizard&&t.content.items&&!t.content.items.length?(i(),d("div",ye,[c("div",Ce,[c("div",Se,[c("div",Pe,[c("h2",{class:"fs-2x fw-bold mb-0",textContent:k(t.content.title)},null,8,Ae),c("p",{class:"text-gray-400 fs-4 font-semibold py-7",textContent:k(t.translate("Add your first route using this below wizard"))},null,8,Ee),c("a",{textContent:k(t.translate("add_new")),onClick:f[0]||(f[0]=(...o)=>t.addRouteWizard&&t.addRouteWizard(...o)),href:"javascript:;",class:"text-white btn btn-primary er fs-6 px-8 py-4"},null,8,Re)]),c("div",ze,[c("img",{src:"/src/asset/img/1.png",alt:"",class:"mx-auto mw-100 h-200px h-sm-325px"},null,8,Fe)])])])])):r("",!0),t.content.items&&!t.showWizard?(i(),d("main",Ie,[c("div",Le,[c("h1",{class:"font-bold text-lg w-full",textContent:k(t.content.title)},null,8,De),t.showWizard?r("",!0):(i(),d("a",{key:0,href:"javascript:;",class:"uppercase p-2 mx-2 text-center text-white w-32 rounded-lg bg-danger",onClick:f[1]||(f[1]=o=>{t.showAddSide=!0,t.activeItem={}})},k(t.translate("add_new")),1))]),Oe,c("div",Te,[t.content.columns?(i(),P(F,{key:0,class:"align-middle fs-6 gy-5 table table-row-dashed px-6","body-text-direction":t.translate("lang")=="ar"?"right":"left","fixed-checkbox":"",headers:t.content.columns,items:t.content.items},{"item-picture":A(o=>[c("img",{src:o.picture,class:"w-8 h-8 rounded-full"},null,8,We)]),"item-pickup_locations":A(o=>[c("div",Me,[(i(!0),d(ne,null,ie(o.pickup_locations,(_,w)=>(i(),d("div",{style:j("left: "+20*w+"px"),class:"rounded-full w-8 h-8 left-0 top-0 absolute"},[w<3?(i(),d("img",{key:w,class:"rounded-full w-8 h-8 rounded-[50px] border-2 border-purple-800",src:_.student&&_.student.picture?_.student.picture:"https://via.placeholder.com/37x37"},null,8,Ve)):r("",!0)],4))),256)),c("span",{class:"flex absolute pt-2",style:j("left: "+(20*(o.pickup_locations.length<3?o.pickup_locations.length:3)+20)+"px")},[D(u),o.pickup_locations?(i(),d("span",{key:0,class:"font-semibold px-1",textContent:k(o.pickup_locations.length)},null,8,Ne)):r("",!0)],4)])]),"item-edit":A(o=>[o.not_editable?r("",!0):(i(),d("button",{key:0,class:"p-2 hover:text-gray-600 text-purple",onClick:_=>t.handleAction("edit",o)},[D(y,{class:"w-5",type:"edit"})],8,Be))]),"item-delete":A(o=>[o.not_removeable?r("",!0):(i(),d("button",{key:0,class:"p-2 hover:text-gray-600 text-red-500",onClick:_=>t.handleAction("delete",o)},[D(b,{class:"w-5"})],8,je))]),_:1},8,["body-text-direction","headers","items"])):r("",!0),t.showAddSide&&t.content&&t.content.fillable?(i(),P(I,{key:1,onCallback:t.closeSide,conf:h.conf,model:"Routes.create",columns:t.content.fillable,class:"col-md-3"},null,8,["onCallback","conf","columns"])):r("",!0),t.showEditSide&&!t.showAddSide?(i(),P(x,{onCallback:t.closeSide,key:t.activeItem,conf:h.conf,model:"Routes.update",item:t.activeItem,model_id:t.activeItem.route_id,index:"route_id",columns:t.content.fillable,class:"col-md-3"},null,8,["onCallback","conf","item","model_id","columns"])):r("",!0)])])):r("",!0)])):r("",!0)])}const Xe=ee(we,[["render",Je]]);export{Xe as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["map-GtxasIM0.min.js","index.es-sRIzCSW1.min.js","index.min.js","index.min.css","side-form-create-CbF3czHg.min.js","Field-r_1gxBn8.min.js","Field.min.css","side-form-update-_mffNT-n.min.js","form_field-J_TGEATC.min.js","editable_map_location-uq_QjuLd.min.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
