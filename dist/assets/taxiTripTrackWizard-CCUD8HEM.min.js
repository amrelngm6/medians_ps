const __vite__fileDeps=["form_field-CbmZmt4p.min.js","index.min.js","index.min.css","Field-4v8-fdjo.min.js","Field.min.css","editable_map_location-lYN01YLq.min.js","index.es-BqyRJkQ3.min.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as X,r as l,U as ot,a as P,o as r,c as _,y as q,z as F,g as T,F as lt,f as nt,d as t,b as m,H as at,A as it,I as ct,t as j,ak as K,e as i,n as dt,K as rt,q as ut,u as _t,s as Z,L as H,a7 as vt,l as mt,M as gt,N as Q,O as ht,p as pt}from"./index.min.js";import{e as ft}from"./editable_map_location-lYN01YLq.min.js";import{d as xt}from"./drivers_locations_map-B0dfK7Oo.min.js";import{t as kt}from"./tooltip-B6mCVe86.min.js";import{O as yt,L as wt,j as Ct}from"./index.es-BqyRJkQ3.min.js";const bt={components:{GoogleMap:yt,Polyline:wt,CustomMarker:Ct},emits:["markerclicked"],setup(a,{emit:w}){const c=l(null),e=l(null),L=l(10),o=l([]),g=l([]),f=l([]),x=l({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),n=l(a.trip),C=()=>{if(n.value.status=="started")return{lat:Number(n.value.vehicle.latitude??0),lng:Number(n.value.vehicle.longitude??0)}},M=(h,b,D)=>{let v=JSON.parse(JSON.stringify(h));return v.icon=a.conf.url+"uploads/images/"+D,v.marker_position=b,v.drag=!1,v};(()=>{o.value=[M(n.value,C()??{lat:n.value.pickup_latitude,lng:n.value.pickup_longitude},"car.svg")],o.value[o.value.length]=M(n.value,{lat:n.value.destination_latitude,lng:n.value.destination_longitude},"destination.svg")})();const k=l({lat:0,lng:0}),N=l({lat:0,lng:0}),S=l(null),y=l(null),E=()=>{setTimeout(function(){S.value=new window.google.maps.DirectionsService,y.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:c,panel:document.getElementById("panel")}),y.value.addListener("directions_changed",()=>{y.value.getDirections()}),W(k.value,N.value,S.value,y.value)},1e3)},W=(h,b,D,v)=>{D.route({origin:h,destination:b,travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(O=>{console.log(O);const A=R(O);f.value=A,g.value={path:A,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(O=>{alert("Could not display directions due to: "+O)})},R=h=>{const b=h.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(b).map(v=>({lat:v.lat(),lng:v.lng()}))},U=h=>{w("markerclicked",h)};return ot(()=>{k.value=C()??{lat:n.value.pickup_latitude,lng:n.value.pickup_longitude},e.value=k.value,N.value={lat:n.value.destination_latitude,lng:n.value.destination_longitude},E()}),{map:c,markerClicked:U,markers:o,mapCenter:e,mapZoom:L,polylinePath:g,routeCoordinates:f,polylineOptions:x}},props:["system_setting","trip","conf"]},It={class:"w-full overflow-auto"},Pt={style:{"text-align":"center"}},St=["src"],Dt=t("div",{id:"panel"},null,-1),Ot=t("div",{id:"total"},null,-1);function Tt(a,w,c,e,L,o){const g=P("Polyline"),f=P("CustomMarker"),x=P("GoogleMap");return r(),_("div",It,[e.mapCenter?(r(),q(x,{"api-key":c.system_setting.google_map_api,ref:"map",center:e.mapCenter,key:`${e.mapCenter.lat},${e.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:e.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:F(()=>[T(g,{options:e.polylinePath},null,8,["options"]),(r(!0),_(lt,null,nt(e.markers,(n,C)=>(r(),q(f,{options:{position:n.marker_position},onClick:M=>e.markerClicked(n)},{default:F(()=>[t("div",Pt,[t("img",{src:n.icon,width:"40",class:"rounded-full",height:"40",style:{"margin-top":"8px"}},null,8,St)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):m("",!0),Dt,Ot])}const Lt=X(bt,[["render",Tt]]),Mt=ut(()=>_t(()=>import("./form_field-CbmZmt4p.min.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Nt={components:{taxt_trip_map:Lt,close_icon:at,delete_icon:it,car_icon:ct,form_field:Mt,editable_map_location:ft,drivers_locations_map:xt,tooltip:kt},name:"Taxi trips",emits:["callback"],setup(a,{emit:w}){const c=l(!1),e=l(!1),L=l(!1);l(null);const o=l({}),g=l(a.usertype),f=l({}),x=l({});l([]),l(!0);const n=l(""),C=l(null),M=l(!1),G=l([a.usertype,"Pickup location","Destination","Driver","Time","Cost","Confirm"]),k=l([]),N=l(!1),S=l(""),y=l(""),E=l([{title:j("Scheduled"),status:"scheduled"},{title:j("Started"),status:"started"},{title:j("Completed"),status:"completed"},{title:j("Cancelled"),status:"cancelled"}]);console.log(a.item),a.item?(o.value=a.item,o.value.date=a.item.date??K()):o.value.date=K();const W=a.userslist?l(a.userslist):l([]),R=async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{o.value.trip_id||(o.value.pickup_latitude=s.coords.latitude,o.value.pickup_longitude=s.coords.longitude,o.value.destination_latitude=s.coords.latitude,o.value.destination_longitude=s.coords.longitude)},s=>{o.value.trip_id||(o.value.pickup_latitude=o.value.pickup_latitude??30.06,o.value.pickup_longitude=o.value.pickup_longitude??31.21,o.value.destination_latitude=o.value.destination_latitude??30.06,o.value.destination_longitude=o.value.destination_longitude??31.21),Z(s.message)}):(Z("location error"),C.value="Geolocation is not supported by this browser.")};R();const U=async()=>{let s=S.value.length>3?await H(a.system_setting.google_map_api,S.value,a.business_setting.country):"";k.value=s.predictions},h=async()=>{let s=y.value.length>3?await H(a.system_setting.google_map_api,y.value,a.business_setting.country):"";k.value=s.predictions},b=()=>{c.value=!0;var s=new URLSearchParams;let d=JSON.parse(JSON.stringify(o.value)),p=Object.keys(d),u,V;for(let z=0;z<p.length;z++)u=p[z],V=typeof d[u]=="object"?JSON.stringify(d[u]):d[u],s.append("params["+u+"]",V);let B=d.trip_id>0?"update":"create";s.append("type","TaxiTrip."+B);const I=vt();I&&(I.root.data.loader=!0),mt(s,"/api/"+B).then(z=>{gt(z),c.value=!1})},D=async s=>{o.value.pickup_latitude=s.lat(),o.value.pickup_longitude=s.lng(),o.value.pickup_address=await Q(s.lat(),s.lng())},v=async s=>{o.value.destination_latitude=s.lat(),o.value.destination_longitude=s.lng(),o.value.destination_address=await Q(s.lat(),s.lng())},O=async(s,d)=>{const p=new google.maps.places.PlacesService(document.createElement("div"));let u=s.place_id;p.getDetails({placeId:u},(V,B)=>{if(B===google.maps.places.PlacesServiceStatus.OK&&V){const I=V.geometry.location;d=="pickup"&&(o.value.pickup_address=s.description,o.value.pickup_latitude=I.lat(),o.value.pickup_longitude=I.lng()),d=="destination"&&(o.value.destination_address=s.description,o.value.destination_latitude=I.lat(),o.value.destination_longitude=I.lng()),k.value=[],N.value=!1}else console.error("Failed to fetch place details")})},A=()=>{w("callback")},Y=()=>ht(["model_id","driver_id","pickup_address","destination_address","status"],o),$=s=>{o.value.model_id=a.usertype=="student"?s.student_id:s.customer_id,o.value.model=s,g.value="Pickup location",n.value=null},tt=s=>{o.value.driver_id=s.driver_id,o.value.driver=s,J(s.vehicle)},J=s=>{o.value.vehicle_id=s.vehicle_id,o.value.vehicle=s,n.value=null},et=()=>{if(a.userslist)for(let s=0;s<a.userslist.length;s++)a.userslist[s].show=n.value.trim()?st(a.userslist[s]):1},st=s=>{let d=!!s.name.toLowerCase().includes(n.value.toLowerCase()),p=d||!!s.email.toLowerCase().includes(n.value.toLowerCase());return p||!!s.mobile.toLowerCase().includes(n.value.toLowerCase())};return{loader:c,tripsStatusList:E,selectedObject:(s,d)=>{const p=o.value[d];for(let u=0;u<s.length;u++)if(s[u][d]==p)return s[u];return{}},setDriver:tt,setVehicle:J,users:W,progressWidth:Y,setUser:$,findUser:et,setPlaceMarker:O,showPlaceSearch:N,pickupPlaceChanged:U,destinationPlaceChanged:h,pickup_placeSearch:S,destination_placeSearch:y,places:k,showAddSide:e,showEditSide:L,content:f,fillable:G,center:x,activeItem:o,activeTab:g,translate:j,updatePickupMarker:D,updateDestinationMarker:v,searchText:n,getUserLocation:R,collapsed:M,saveTrip:b,back:A}},props:["conf","path","system_setting","business_setting","setting","item","userslist","usertype","drivers","vehicles","currency"]},Vt={class:"w-full"},zt=t("img",{class:"m-auto w-500px",src:"/uploads/loader.gif"},null,-1),jt=[zt],Rt={class:"w-full flex overflow-auto"},At={class:"w-full relative"},Bt={class:"card w-full py-10"},Et={class:"w-full stepper stepper-links"},Wt={class:"w-full"},Ut={class:""},Gt={class:"card-body pt-0 mx-auto"},Jt={class:"w-full flex gap-10"},qt={class:"w-full"},Ft={class:"w-full"},Kt=t("hr",{class:"block mt-6 my-2 opacity-10"},null,-1),Zt={class:"bg-gray-200 shadow-md mb-10 rounded-xl"},Ht={class:"card-header border-0 pt-9"},Qt={key:0,class:"card-title m-0 flex gap-4"},Xt={class:"symbol symbol-50px w-50px bg-light"},Yt=["src"],$t={class:"w-full"},te=["textContent"],ee=["textContent"],se={key:0,class:"card-body p-9"},oe={class:"timeline timeline-border-dashed"},le={class:"timeline-item"},ne=t("div",{class:"timeline-line"},null,-1),ae={class:"timeline-icon me-4"},ie={class:"timeline-content mb-10 mt-n2"},ce={class:"overflow-auto pe-3"},de=["textContent"],re={class:"d-flex align-items-center mt-1 fs-6"},ue=["textContent"],_e={class:"timeline-item"},ve=t("div",{class:"timeline-line"},null,-1),me={class:"timeline-icon me-4"},ge={class:"timeline-content mb-10 mt-n2"},he={class:"overflow-auto pe-3"},pe=["textContent"],fe={class:"d-flex align-items-center mt-1 fs-6"},xe=["textContent"],ke={class:"h-4px w-100 bg-light mb-5"},ye={key:0,class:"w-full flex gap-4"},we={key:0,class:"flex gap-4 w-full"},Ce=["src"],be={class:"block gap-4 w-full"},Ie=["textContent"],Pe=["textContent"],Se={key:1,class:"w-full flex gap-4"},De={class:"block gap-4"},Oe=["textContent"],Te=["textContent"],Le={key:2,class:"w-full flex-end"},Me=["textContent"],Ne={class:"w-full flex gap-4"},Ve=["textContent"],ze=["textContent"],je={class:"flex gap-6 pb-4 font-semibold text-lg"},Re={class:"flex gap-6 w-full"},Ae=["textContent"],Be=["textContent"],Ee={class:"flex gap-6 w-full"},We=["textContent"],Ue=["textContent"],Ge={class:"flex gap-6 w-full"},Je=["textContent"],qe=["textContent"],Fe={class:"notice d-flex bg-light-warning rounded border-warning border border-dashed mb-12 p-6 gap-4"},Ke=pt('<i class="vue-feather vue-feather--alert-octagon ki-duotone ki-information fs-2tx text-warning me-4" data-name="alert-octagon" data-tags="warning,alert,danger" data-type="alert-octagon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-octagon vue-feather__content"><polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"></polygon><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg></i>',1),Ze={class:"d-flex flex-stack flex-grow-1"},He={class:"fw-semibold"},Qe=["textContent"],Xe={class:"fs-6 text-gray-700"},Ye=["textContent"],$e={class:"text-center mt-10"},ts=["textContent"];function es(a,w,c,e,L,o){const g=P("close_icon"),f=P("taxt_trip_map"),x=P("vue-feather"),n=P("car_icon");return r(),_("div",Vt,[e.loader?(r(),_("div",{key:e.loader,class:"bg-white fixed w-full h-full top-0 left-0",style:{"z-index":"99999",opacity:".9"}},jt)):m("",!0),t("div",Rt,[t("div",At,[T(g,{class:"absolute top-4 right-4 z-10 cursor-pointer",onClick:e.back},null,8,["onClick"]),t("div",Bt,[t("div",Et,[t("div",Wt,[t("div",Ut,[t("div",Gt,[t("div",Jt,[t("div",qt,[T(f,{onMarkerclicked:a.markerClicked,class:"w-full rounded-xl shadow-md mx-4",system_setting:c.system_setting,conf:c.conf,trip:e.activeItem},null,8,["onMarkerclicked","system_setting","conf","trip"])]),t("div",Ft,[Kt,t("div",Zt,[t("div",Ht,[e.activeItem.model?(r(),_("div",Qt,[t("div",Xt,[t("img",{src:e.activeItem.model.picture,alt:"image",class:"p-3"},null,8,Yt)]),t("div",$t,[t("div",{class:"font-semibold",textContent:i(e.activeItem.model.name)},null,8,te),t("div",{class:"",textContent:i(e.activeItem.model.mobile)},null,8,ee)])])):m("",!0)]),e.activeItem?(r(),_("div",se,[t("div",oe,[t("div",le,[ne,t("div",ae,[T(x,{type:"circle",class:"fs-2 text-success"})]),t("div",ie,[t("div",ce,[e.activeItem?(r(),_("div",{key:0,class:"fs-5 fw-semibold mb-2",textContent:i(e.activeItem.pickup_address)},null,8,de)):m("",!0),t("div",re,[t("div",{class:"text-muted me-2 fs-7",textContent:i(e.translate("Pickup"))},null,8,ue)])])])]),t("div",_e,[ve,t("div",me,[T(x,{type:"map-pin",class:"fs-2 text-danger"})]),t("div",ge,[t("div",he,[e.activeItem?(r(),_("div",{key:0,class:"fs-5 fw-semibold mb-2",textContent:i(e.activeItem.destination_address)},null,8,pe)):m("",!0),t("div",fe,[t("div",{class:"text-muted me-2 fs-7",textContent:i(e.translate("Destination"))},null,8,xe)])])])])]),t("div",ke,[t("div",{class:dt(["rounded h-4px transition transition-all",e.progressWidth()<100?"bg-info":"bg-success"]),role:"progressbar",style:rt({width:e.progressWidth()+"%"})},null,6)]),e.activeItem?(r(),_("div",ye,[e.activeItem.driver?(r(),_("div",we,[t("img",{src:e.activeItem.driver.picture,class:"rounded-full bg-white border-1 border border-gray-600 p-1 w-12 h-12"},null,8,Ce),t("div",be,[t("span",{class:"w-full block font-semibold",textContent:i(e.translate("Driver"))},null,8,Ie),t("span",{class:"w-full block",textContent:i(e.activeItem.driver.name)},null,8,Pe)])])):m("",!0),e.activeItem.vehicle?(r(),_("div",Se,[T(n),t("div",De,[t("span",{class:"w-full block font-semibold",textContent:i(e.translate("Vehicle"))},null,8,Oe),t("span",{class:"w-full block",textContent:i(e.activeItem.vehicle.plate_number)},null,8,Te)])])):m("",!0),e.activeItem.date?(r(),_("div",Le,[t("span",{class:"w-full block font-semibold",textContent:i(e.translate("Trip date"))},null,8,Me),t("div",Ne,[t("span",{class:"",textContent:i(e.activeItem.date)},null,8,Ve),t("span",{class:"",textContent:i(e.activeItem.start_time)},null,8,ze)])])):m("",!0)])):m("",!0)])):m("",!0)]),t("div",je,[t("div",Re,[t("div",{textContent:i(e.translate("Subtotal"))},null,8,Ae),t("div",{textContent:i(c.currency.symbol+""+e.activeItem.subtotal)},null,8,Be)]),t("div",Ee,[t("div",{textContent:i(e.translate("Discount"))},null,8,We),t("div",{textContent:i(c.currency.symbol+""+e.activeItem.discount_amount)},null,8,Ue)]),t("div",Ge,[t("div",{textContent:i(e.translate("Total cost"))},null,8,Je),t("div",{textContent:i(c.currency.symbol+""+e.activeItem.total_cost)},null,8,qe)])]),t("div",Fe,[Ke,t("div",Ze,[t("div",He,[t("h4",{class:"text-gray-900 fw-bold",textContent:i(e.translate(e.activeItem.payment_status))},null,8,Qe),t("div",Xe,[t("div",{textContent:i(e.translate("Payment status"))},null,8,Ye)])])])])])]),t("p",$e,[t("a",{href:"javascript:;",class:"uppercase px-4 py-3 mx-2 text-center text-white rounded-lg bg-danger",onClick:w[0]||(w[0]=(...C)=>e.back&&e.back(...C)),textContent:i(e.translate("Back"))},null,8,ts)])])])])])])])])])}const cs=X(Nt,[["render",es]]);export{cs as default};
