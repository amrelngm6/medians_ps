import{_ as G,r as t,U as L,a as C,o as m,c as M,y as O,O as D,g as S,F as z,f as I,d as g,b as E}from"./index.min.js";import{O as J,L as W,j as Z}from"./index.es-BqyRJkQ3.min.js";const A={components:{GoogleMap:J,Polyline:W,CustomMarker:Z},emits:["markerclicked"],setup(_,{emit:f}){const r=t(null),o=t(null),w=t(11),i=t([]),c=t([]),u=t([]),v=t({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),n=t(_.trip),k=(e,a="lat",p="lng",s)=>{let l=JSON.parse(JSON.stringify(e));return l.icon=_.conf.url+"uploads/images/"+s,l.marker_position={lat:parseFloat(e[a]),lng:parseFloat(e[p])},l.drag=!1,l};(()=>{i.value=[k(n.value,"pickup_latitude","pickup_longitude","car.svg")],i.value[i.value.length]=k(n.value,"destination_latitude","destination_longitude","destination.svg")})();const y=t({lat:0,lng:0}),P=t({lat:0,lng:0}),x=t(null),d=t(null),N=()=>{setTimeout(function(){x.value=new window.google.maps.DirectionsService,d.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:r,panel:document.getElementById("panel")}),d.value.addListener("directions_changed",()=>{const e=d.value.getDirections();e&&T(e)}),B(y.value,P.value,x.value,d.value)},1e3)},B=(e,a,p,s)=>{p.route({origin:e,destination:a,travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(l=>{console.log(l);const h=R(l);u.value=h,console.log(h),c.value={path:h,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(l=>{alert("Could not display directions due to: "+l)})},R=e=>{const a=e.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(a).map(s=>({lat:s.lat(),lng:s.lng()}))},T=e=>{const a=e.routes[0];!a||a.legs},F=async()=>N();return L(()=>{y.value={lat:n.value.pickup_latitude,lng:n.value.pickup_longitude},o.value=y.value,P.value={lat:n.value.destination_latitude,lng:n.value.destination_longitude},F()}),{map:r,markerClicked:e=>{f("markerclicked",e)},markers:i,mapCenter:o,mapZoom:w,polylinePath:c,routeCoordinates:u,polylineOptions:v}},props:["system_setting","trip","conf"]},U={class:"w-full overflow-auto"},b={style:{"text-align":"center"}},j=["src"],q=g("div",{id:"panel"},null,-1),H=g("div",{id:"total"},null,-1);function K(_,f,r,o,w,i){const c=C("Polyline"),u=C("CustomMarker"),v=C("GoogleMap");return m(),M("div",U,[o.mapCenter?(m(),O(v,{"api-key":r.system_setting.google_map_api,ref:"map",center:o.mapCenter,key:`${o.mapCenter.lat},${o.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:o.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:D(()=>[S(c,{options:o.polylinePath},null,8,["options"]),(m(!0),M(z,null,I(o.markers,(n,k)=>(m(),O(u,{options:{position:n.marker_position},onClick:V=>o.markerClicked(n)},{default:D(()=>[g("div",b,[g("img",{src:n.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,j)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):E("",!0),q,H])}const $=G(A,[["render",K]]);export{$ as t};
