import{_ as I,r as n,U as W,a as w,o as y,c as x,y as N,O as V,g as E,F,f as J,d as k,b as B}from"./index.min.js";import{O as Z,L as U,j as q}from"./index.es-BqyRJkQ3.min.js";const A={components:{GoogleMap:Z,Polyline:U,CustomMarker:q},emits:["markerclicked"],setup(s,{emit:C}){const d=n(null),l=n(null),P=n(10),a=n([]),p=n([]),g=n([]),h=n({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),o=n(s.trip),c=n({lat:0,lng:0}),m=n({lat:0,lng:0}),M=n(null),v=n(null),O=()=>{if(o.value.status=="started")return{lat:Number(o.value.vehicle.latitude??0),lng:Number(o.value.vehicle.longitude??0)}},D=(e,t,i)=>{var r=e.model&&e.model.picture?e.model.picture:i,u=e.status=="waiting"?e.location.start_latitude:e.location.end_latitude,_=e.status=="waiting"?e.location.start_longitude:e.location.end_longitude;return f(o.value,{lat:u,lng:_},r)},f=(e,t,i="uploads/images/car.svg")=>{let r=JSON.parse(JSON.stringify(e));return r.icon=s.conf.url+i,r.marker_position=t,r.drag=!1,r},R=()=>{if(a.value=[f(o.value,O()??c.value,"uploads/images/car.svg")],console.log(a.value),s.waypoints)for(let t=0;t<s.waypoints.length;t++){var e=s.waypoints[t];(e.status=="waiting"||e.status=="moving")&&(a.value[t+1]=D(e))}a.value[a.value.length]=f(o.value,m.value,"uploads/images/destination.svg"),a.value=a.value.filter(t=>t!=null)},T=()=>{setTimeout(function(){M.value=new window.google.maps.DirectionsService,v.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:d,panel:document.getElementById("panel")}),v.value.addListener("directions_changed",()=>{v.value.getDirections()}),G(c.value,m.value,M.value,v.value)},1e3)},G=(e,t,i,r)=>{i.route({origin:e,destination:t,waypoints:z(),travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(u=>{const _=L(u);g.value=_,p.value={path:_,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(u=>{alert("Could not display directions due to: "+u)})},L=e=>{const t=e.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(t).map(r=>({lat:r.lat(),lng:r.lng()}))},S=e=>{C("markerclicked",e)},z=()=>{var e=[];for(let t=0;t<a.value.length;t++){const i=a.value[t];i&&i.marker_position&&(e[t]={location:i.marker_position})}return console.log(e.filter(t=>t!=null)),e.length?e.filter(t=>t!=null):null};return W(()=>{c.value=O()??{lat:o.value.route.position.start_latitude,lng:o.value.route.position.start_longitude},l.value=c.value,m.value={lat:o.value.route.position.end_latitude,lng:o.value.route.position.end_longitude},R(),T()}),{map:d,markerClicked:S,markers:a,mapCenter:l,mapZoom:P,polylinePath:p,routeCoordinates:g,polylineOptions:h}},props:["system_setting","trip","conf","waypoints","center"]},H={class:"w-full overflow-auto"},K={style:{"text-align":"center"}},Q=["src"],X=k("div",{id:"panel"},null,-1),Y=k("div",{id:"total"},null,-1);function $(s,C,d,l,P,a){const p=w("Polyline"),g=w("CustomMarker"),h=w("GoogleMap");return y(),x("div",H,[l.mapCenter?(y(),N(h,{"api-key":d.system_setting.google_map_api,ref:"map",center:l.mapCenter,key:`${l.mapCenter.lat},${l.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:l.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:V(()=>[E(p,{options:l.polylinePath},null,8,["options"]),s.marker?(y(!0),x(F,{key:0},J(l.markers,(o,c)=>(y(),N(g,{options:{position:o.marker_position},onClick:m=>l.markerClicked(o)},{default:V(()=>[k("div",K,[k("img",{src:o.icon,width:"40",class:"rounded-full",height:"40",style:{"margin-top":"8px"}},null,8,Q)])]),_:2},1032,["options","onClick"]))),256)):B("",!0)]),_:1},8,["api-key","center","zoom"])):B("",!0),X,Y])}const ee=I(A,[["render",$]]);export{ee as t};
