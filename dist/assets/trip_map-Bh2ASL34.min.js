import{_ as z,r as n,U as I,a as w,o as k,c as V,y as B,O as D,g as W,F as E,f as F,d as y,b as J}from"./index.min.js";import{O as Z,L as U,j as q}from"./index.es-BqyRJkQ3.min.js";const A={components:{GoogleMap:Z,Polyline:U,CustomMarker:q},emits:["markerclicked"],setup(c,{emit:P}){const d=n(null),a=n(null),M=n(10),s=n([]),p=n([]),g=n([]),h=n({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),t=n(c.trip),m=()=>{if(t.value.status=="started")return{lat:Number(t.value.vehicle.latitude??0),lng:Number(t.value.vehicle.longitude??0)}},x=(e,o,r)=>{var l=e.model&&e.model.picture?e.model.picture:r,u=e.status=="waiting"?e.location.start_latitude:e.location.end_latitude,_=e.status=="waiting"?e.location.start_longitude:e.location.end_longitude;return f(t.value,m()??{lat:u,lng:_},l)},f=(e,o,r="uploads/images/car.svg")=>{let l=JSON.parse(JSON.stringify(e));return l.icon=c.conf.url+r,l.marker_position=o,l.drag=!1,l};(()=>{if(s.value=[f(t.value,m()??{lat:t.value.pickup_latitude,lng:t.value.pickup_longitude},"uploads/images/car.svg")],c.waypoints)for(let o=0;o<c.waypoints.length;o++){var e=c.waypoints[o];s.value[i+1]=x(e)}s.value[s.value.length]=f(t.value,{lat:t.value.destination_latitude,lng:t.value.destination_longitude},"uploads/images/destination.svg")})();const C=n({lat:0,lng:0}),O=n({lat:0,lng:0}),N=n(null),v=n(null),R=()=>{setTimeout(function(){N.value=new window.google.maps.DirectionsService,v.value=new window.google.maps.DirectionsRenderer({draggable:!0,map:d,panel:document.getElementById("panel")}),v.value.addListener("directions_changed",()=>{v.value.getDirections()}),T(C.value,O.value,N.value,v.value)},1e3)},T=(e,o,r,l)=>{r.route({origin:e,destination:o,waypoints:S(),travelMode:window.google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(u=>{console.log(u);const _=G(u);g.value=_,p.value={path:_,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}).catch(u=>{alert("Could not display directions due to: "+u)})},G=e=>{const o=e.routes[0].overview_polyline;return window.google.maps.geometry.encoding.decodePath(o).map(l=>({lat:l.lat(),lng:l.lng()}))},L=e=>{P("markerclicked",e)},S=()=>{var e=[];for(let o=0;o<s.value.length;o++){const r=s.value[o];e[o]={location:r.marker_position}}return e};return I(()=>{C.value=m()??{lat:t.value.pickup_latitude,lng:t.value.pickup_longitude},a.value=C.value,O.value={lat:t.value.destination_latitude,lng:t.value.destination_longitude},R()}),{map:d,markerClicked:L,markers:s,mapCenter:a,mapZoom:M,polylinePath:p,routeCoordinates:g,polylineOptions:h}},props:["system_setting","trip","conf","waypoints","center"]},H={class:"w-full overflow-auto"},K={style:{"text-align":"center"}},Q=["src"],X=y("div",{id:"panel"},null,-1),Y=y("div",{id:"total"},null,-1);function $(c,P,d,a,M,s){const p=w("Polyline"),g=w("CustomMarker"),h=w("GoogleMap");return k(),V("div",H,[a.mapCenter?(k(),B(h,{"api-key":d.system_setting.google_map_api,ref:"map",center:a.mapCenter,key:`${a.mapCenter.lat},${a.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:a.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:D(()=>[W(p,{options:a.polylinePath},null,8,["options"]),(k(!0),V(E,null,F(a.markers,(t,m)=>(k(),B(g,{options:{position:t.marker_position},onClick:x=>a.markerClicked(t)},{default:D(()=>[y("div",K,[y("img",{src:t.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,Q)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):J("",!0),X,Y])}const te=z(A,[["render",$]]);export{te as t};
