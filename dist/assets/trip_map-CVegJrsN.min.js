import{_ as T,r as o,U as F,a as f,o as _,c as x,y as O,O as D,g as L,F as E,f as G,d as k,b as I,ai as W}from"./index.min.js";import{O as $,L as z,j as U}from"./index.es-BqyRJkQ3.min.js";const b={components:{GoogleMap:$,Polyline:z,CustomMarker:U},emits:["markerclicked"],setup(d,{emit:C}){const p=o(null),n=o(null),w=o(12),c=o([]),m=o([]),g=o([]),h=o({strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2}),s=o(d.trip),y=(a,e="lat",t="lng",i)=>{let l=JSON.parse(JSON.stringify(a));return l.icon=d.conf.url+"uploads/images/"+i,l.marker_position={lat:parseFloat(a[e]),lng:parseFloat(a[t])},l.drag=!1,l};(()=>{c.value=[y(s.value,"pickup_latitude","pickup_longitude","car.svg")],c.value[c.value.length]=y(s.value,"destination_latitude","destination_longitude","destination.svg")})();const r=o({lat:0,lng:0}),u=o({lat:0,lng:0}),M=o(null),v=o(null),N=a=>{p.value&&(M.value=new google.maps.DirectionsService,v.value=new google.maps.DirectionsRenderer({draggable:!0,map:p,panel:document.getElementById("panel")}),v.value.addListener("directions_changed",()=>{const e=v.value.getDirections();e&&B(e)}),V("Perth, WA","Sydney, NSW",M.value,v.value))},V=(a,e,t,i)=>{t.route({origin:a,destination:e,waypoints:[{location:r.value.lat+","+r.value.lng},{location:u.value.lat+","+u.value.lng}],travelMode:google.maps.TravelMode.DRIVING,avoidTolls:!0}).then(l=>{i.setDirections(l)}).catch(l=>{alert("Could not display directions due to: "+l)})},B=a=>{let e=0;const t=a.routes[0];if(t){for(let i=0;i<t.legs.length;i++)e+=t.legs[i].distance.value;e=e/1e3,document.getElementById("total").innerHTML=e+" km"}},R=async()=>{const e=`https://maps.googleapis.com/maps/api/directions/json?origin=${r.value.lat},${r.value.lng}&destination=${u.value.lat},${u.value.lng}&key=${d.system_setting.google_map_api}`;N();try{const t=await fetch(e);if(t.ok){const i=await t.json(),l=W(i.routes[0].overview_polyline.points);g.value=l,m.value={path:l,geodesic:!0,strokeColor:"#000",strokeOpacity:.9,strokeWeight:2}}else console.error("Failed to fetch route:",t.statusText)}catch(t){console.error("Error fetching route:",t)}};F(()=>{r.value={lat:s.value.pickup_latitude,lng:s.value.pickup_longitude},n.value=r.value,u.value={lat:s.value.destination_latitude,lng:s.value.destination_longitude},R()});const S=a=>{C("markerclicked",a)};return{mapRef,markerClicked:S,markers:c,mapCenter:n,mapZoom:w,polylinePath:m,routeCoordinates:g,polylineOptions:h}},props:["system_setting","trip","conf"]},j={class:"w-full overflow-auto"},A={style:{"text-align":"center"}},J=["src"],Z=k("div",{id:"panel"},null,-1),H=k("div",{id:"total"},null,-1);function q(d,C,p,n,w,c){const m=f("Polyline"),g=f("CustomMarker"),h=f("GoogleMap");return _(),x("div",j,[n.mapCenter?(_(),O(h,{"api-key":p.system_setting.google_map_api,ref:"map",center:n.mapCenter,key:`${n.mapCenter.lat},${n.mapCenter.lng}`,options:{zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0},zoom:n.mapZoom,style:{width:"100%",height:"calc(100vh - 100px)"}},{default:D(()=>[L(m,{options:n.polylinePath},null,8,["options"]),(_(!0),x(E,null,G(n.markers,(s,y)=>(_(),O(g,{options:{position:s.marker_position},onClick:P=>n.markerClicked(s)},{default:D(()=>[k("div",A,[k("img",{src:s.icon,width:"40",class:"rouned-full",height:"40",style:{"margin-top":"8px"}},null,8,J)])]),_:2},1032,["options","onClick"]))),256))]),_:1},8,["api-key","center","zoom"])):I("",!0),Z,H])}const X=T(b,[["render",q]]);export{X as t};
